{"title":"How useful are restaurant reviews? Google and Trip Advisor reviews in the Klang Valley, Malaysia","markdown":{"yaml":{"title":"How useful are restaurant reviews? Google and Trip Advisor reviews in the Klang Valley, Malaysia","subtitle":"Part one","author":"Sean Ng","organization":"AIMdata","date-modified":"26 December 2025","execute":{"echo":false}},"headingText":"Introduction and overview","containsRefs":false,"markdown":"\n\n\n```{r setup, include = FALSE}\n\nknitr::opts_chunk$set(echo = FALSE, \n                      warning = FALSE, \n                      message = FALSE, \n                      fig.width = 9)\n\n\nlibrary(tidyverse)\nlibrary(here)\nlibrary(janitor)\nlibrary(scales)\nlibrary(tidytext)\nlibrary(widyr)\nlibrary(ggraph)\nlibrary(patchwork)\nlibrary(kableExtra)\nlibrary(fuzzyjoin)\nlibrary(viridis)\nlibrary(textdata)\nlibrary(DT)\n\n`%out%` <- Negate(`%in%`)\noptions(scipen = 100)\ntheme_set(theme_light())\nrange_wna <- function(x){(x-min(x, na.rm = TRUE))/(max(x, na.rm = TRUE)-min(x, na.rm = TRUE))}\n\nMode <- function(x) {\n  ux <- unique(x)\n  ux[which.max(tabulate(match(x, ux)))]\n}\n```\n\n\n```{r data}\ngoogle_reviews <- read_csv(\"./data/GoogleReview_data_cleaned.csv\") |> clean_names()\n\ntrip_reviews <- read_csv(\"./data/TripAdvisor_data_cleaned.csv\") |> clean_names() |> \n  mutate(review = str_replace_all(review, \"dim sum|Dim Sum|Dim sum\", \"dimsum\"))\n```\n\n\nA common refrain in this postmodern age is that online reviews are useless. \n\nToday, we're looking at two different sets of scraped restaurant reviews to determine to what extent that is true. Restaurant reviews from Google and Trip Advisor in Malaysia were scraped by [Ng Choon Khon](https://www.kaggle.com/datasets/choonkhonng/malaysia-restaurant-review-datasets) using the Selenium library. \n\nBelow, we've plotted out the restaurants found in both datasets according to the number of reviews and their mean rating. Immediately, we note an unnatural pattern in the Google dataset: Google limits Selenium to only being able to scrape around 300 reviews per restaurant, at most.\n\nWhilst this impacts and limits the dataset, we should still make the best use of it we can: Google's official API only allows five reviews to be extracted per restaurant because data freely given to the world must be paywalled and sold back to you.\n\nThis analysis is ultimately meant to better understanding of Google's and Trip Advisor's review platforms from a consumer perspective, in order to choose more satisfactory restaurants. \n\n\n<br>\n\n```{r histogram, fig.width=9}\ngoogle_reviews |> \n  filter(location %in% c(\"Petaling Jaya\", \"KL\")) |> \n  count(restaurant) |> \n  ggplot(aes(x = n)) + \n  geom_histogram(binwidth = 1/30, \n                 fill = \"#6a994e\") + \n  # geom_freqpoly(colour = \"blue\", alpha = .3) +\n  scale_x_log10(breaks = c(0, 10, 30, 100, 300, 1000), \n                labels = comma) + \n  labs(title = \"Google reviews per restaurant\", \n       subtitle = \"Largely limited to 300 reviews per restaurant\",\n       x = \"Number of reviews\", \n       y = \"Number of restaurants\") +\n\ntrip_reviews |> \n  filter(location %in% c(\"Petaling Jaya\", \"KL\")) |> \n  count(restaurant) |> \n  ggplot(aes(x = n)) + \n  geom_histogram(binwidth = 1/30, \n                 fill = \"#6a994e\") + \n  # geom_freqpoly(colour = \"blue\", alpha = .3) +\n  scale_x_log10(breaks = c(0, 10, 30, 100, 300, 1000), \n                labels = comma) + \n  labs(title = \"Trip Advisor reviews per restaurant\", \n       subtitle = \"No limits for number of reviews scraped\",\n       x = \"Number of reviews\", \n       y = \"Number of restaurants\") +\n\n  plot_annotation(\n    title = \"The Trip Advisor reviews dataset has a much more natural distribution\"\n  )\n\n```\n\n<br>\n\n### Limitations\n\n\n```{r malay-list}\n# Maybe someone with a better grasp of Malay can improve on this, \n# without getting too many false positives\n# But it works pretty well as long as the not_malay_list is run as well\n# The number for Trip Advisor is likely lower still, since there were still some false positives\n# Remember that \nmalay_list <- \" yang|sedap|makanan|Makanan| saya| Saya|dulu|semua|kali|sdap|sangat|Sangat|lauk|harga|tapi|terbaik|berbaloi| dgn|siap|tidak|bole|boleh| lain|cantik\"\n\n# Not really that surprising that \"kalian\" is almost always just a mispelling of \"kailan\", \n# But I'll leave it out as it could make too many false negatives\nnot_malay_list <- \"yangzhou|yang zhou|Yang zhou|wayang|Wayang|tapioca|Tapioca|Gansayam|Rasa Saya|ying yang|yin yang|goyang|fried rice|chargable|hargao\"\n\n# Realising now that there is a malaytextr package\n# Remember to fix this\n\nmalay_pc_summary <- rbind(google_reviews |>\n  filter(!is.na(review)) |> \n  mutate(malay = ifelse(\n  str_detect(review, malay_list) & \n    !str_detect(review, not_malay_list), 1, 0)) |> \n  summarise(count = n(), \n            malay = sum(malay)) |> \n  mutate(malay_pc = round(malay / count * 100, 2), \n         source = \"Google\"),\n\ntrip_reviews |> \n  filter(!is.na(review)) |> \n  mutate(malay = ifelse(\n  str_detect(review, malay_list) & \n    !str_detect(review, not_malay_list), 1, 0)) |> \n  summarise(count = n(), \n            malay = sum(malay)) |> \n  mutate(malay_pc = round(malay / count * 100, 2), \n         source = \"TripAdvisor\"))\n\n```\n\n\n\nLet's review the limitations once more, before we look into these datasets: \n\n* What Google's dataset is representative of cannot be readily explained. For many restaurants, only their first 300 most \"relevant\" reviews have been extracted. Google determines \"relevance\" by using a combination of recency, quality (word count, images) and whether or not a review was regarded by the community as helpful. \n\n* Both Google maps and Trip Advisor are principally English language platforms when the language isn't regularly used by the majority of the population. Upon a cursory inspection, there are very few reviews in Malay in Google (`r malay_pc_summary |> filter(source == \"Google\") |> pull(malay_pc)`%) and even less in Trip Advisor (`r malay_pc_summary |> filter(source == \"TripAdvisor\") |> pull(malay_pc)`%). This is extremely different from even urban demographics (where there are proportionally more minorities, and consequently, English speakers). This bias is more understandable on Trip Advisor than it is on Google. \n* The price range is missing from this dataset. This is unfortunate because price is one of the main topics mentioned in reviews. If I were to rescrape the data, I would definitely prioritise getting the price range. \n\n* These reviews were extracted three years ago: some of these restaurants have closed, or have changed how they operate.  \n\n* Whilst reviews themselves are largely meant to informational, expressive or cautionary, review platforms are mired in layers of obfuscation, gamification and marketing. Additionally, Google's reviews are generally less policed than Trip Advisor's, with notable instances of [scams]((https://www.asiaone.com/lifestyle/restaurant-ibid-woo-wai-leong-police-reviews-scam)) and bribed reviews. Additionally, reviews are further affected by prevailing social mores (we discuss the skew towards five stars below). \n\n\n```{r buffet-fusion-lists}\n\ntrip_buffet_list <- trip_reviews |> \n  mutate(possible_buffet = ifelse(\n    str_detect(review, \"Buffet|buffet\") | \n      str_detect(title, \"Buffet|buffet\") |\n      str_detect(restaurant, \"Buffet|buffet\")\n    , 1, 0), \n    count = 1) |> \n  group_by(restaurant) %>% \n  summarise(reviews = sum(count), \n            buffet_count = sum(count[possible_buffet == 1])) |> \n  arrange(desc(buffet_count)) |> \n  mutate(buffet_pc = buffet_count / reviews) |> \n  mutate_at(vars(reviews, buffet_count, buffet_pc), ~range_wna(.)) |>  \n  mutate(buffet_score = (buffet_count + buffet_pc) / 2) |> \n  arrange(desc(buffet_score)) |> \n  filter(buffet_score >= .2) |> \n  pull(restaurant)\n\ntrip_fusion_list <- trip_reviews |> \n  mutate(possible_fusion = ifelse(\n    str_detect(review, \"Fusion|fusion\") | \n      str_detect(title, \"Fusion|fusion\") |\n      str_detect(restaurant, \"Fusion|fusion\")\n    , 1, 0), \n    count = 1) |> \n  group_by(restaurant) %>% \n  summarise(reviews = sum(count), \n            fusion_count = sum(count[possible_fusion == 1])) |> \n  arrange(desc(fusion_count)) |> \n  mutate(fusion_pc = fusion_count / reviews) |> \n  mutate_at(vars(reviews, fusion_count, fusion_pc), ~range_wna(.)) |>  \n  mutate(fusion_score = (fusion_count +  fusion_pc) / 2) |> \n  arrange(desc(fusion_score)) |> \n  filter(fusion_score >= .11) |> \n  pull(restaurant)\n\ngoogle_buffet_list <- google_reviews |> \n  mutate(possible_buffet = ifelse(\n    str_detect(review, \"Buffet|buffet\") | \n      str_detect(restaurant, \"Buffet|buffet\")\n    , 1, 0), \n    count = 1) |> \n  group_by(restaurant) %>% \n  summarise(reviews = sum(count), \n            buffet_count = sum(count[possible_buffet == 1])) |> \n  arrange(desc(buffet_count)) |> \n  mutate(buffet_pc = buffet_count / reviews) |> \n  mutate_at(vars(reviews, buffet_count, buffet_pc), ~range_wna(.)) |>  \n  mutate(buffet_score = (buffet_count + buffet_pc) / 2) |> \n  arrange(desc(buffet_score)) |> \n  filter(buffet_score >= 0.1764) |> \n  pull(restaurant)\n\ngoogle_fusion_list <- google_reviews |>\n  mutate(possible_fusion = ifelse(\n    str_detect(review, \"Fusion|fusion\") |\n      str_detect(restaurant, \"Fusion|fusion\")\n    , 1, 0), \n    count = 1) |> \n  group_by(restaurant) %>% \n  summarise(reviews = sum(count), \n            fusion_count = sum(count[possible_fusion == 1])) |> \n  arrange(desc(fusion_count)) |> \n  mutate(fusion_pc = fusion_count / reviews) |> \n  mutate_at(vars(reviews, fusion_count, fusion_pc), ~range_wna(.)) |>  \n  mutate(fusion_score = (fusion_count +  fusion_pc) / 2) |> \n  arrange(desc(fusion_score)) |> \n  filter(fusion_score >= .11) |> \n  pull(restaurant)\n```\n\n\n\n```{r reviews-cuisine-cleaning}\n\nreviews_cuisine_cleaning <- function(tbl) {\n  \n  tbl |> \n    # Not a specific restaurant\n    filter(restaurant %out% c(\"Jalan Alor\", \"Sham's Cooked With Love\", \"Hawker Stalls in Chinatown\",\n                              \"Feast Village Starhill Gallery\", \"ICC Pudu\", \"Imbi Market\", \n                              \"Taste of Asia\", \"Thirty8 Fashion\", \"Happy Mansion\")) |> \n    # Location cleaning\n    mutate(location = ifelse(restaurant %in% \n                               c(\"Nizza Restaurant @ Sofitel Kuala Lumpur Damansara\",\n                                 \"Sri Nirwana Maju Restaurant - Bangsar\",\n                                 \"Hornbill Restaurant & Cafe\", \n                                 \"Malai Thai Cuisine @ Cormar Suites\",\n                                 \"Qureshi\",\n                                 \"Aliyaa Island Restaurant & Bar\",\n                                 \"Skillet KL\",\n                                 \"Geographer cafe Kuala Lumpur\",\n                                 \"Gastro Sentral, Le Méridien Kuala Lumpur\",\n                                 \"Horizon Grill @ Banyan Tree Kuala Lumpur\",\n                                 \"Chamber’s Grill\",\n                                 \"Mercat Barcelona Gastrobar (1MontKiara)\",\n                                 \"Chynna\", \n                                 \"The Grand Getaway\",\n                                 \"Dining in the Dark KL\",\n                                 \"Sausage KL Cafe & Deli\"), \n                             \"KL\", \n                             location)) |> \n    # Some cleaning \n    mutate(restaurant = str_replace(restaurant, \"Birch\", \"Huckleberry\")) |> \n    mutate(restaurant = str_replace_all(restaurant, \"Passage thru'\", \"Passage Thru\"),\n           restaurant = str_replace_all(restaurant, \n                                        \"Little Penang Cafe|Little Penang Kafe\",\n                                        \"Little Penang Kafé - KLCC\"),\n           restaurant = str_replace_all(restaurant, \"The Grand Getaway by Grand Hyatt Kuala Lumpur\", \n                                        \"The Grand Getaway\"), \n           restaurant = str_replace_all(restaurant, \"Gravybaby\", \"GravyBaby\"), \n           restaurant = str_replace_all(restaurant, \"Ploy\", \"PLOY\"), \n           restaurant = ifelse(restaurant == \"What Tasty Food\", \"WTF - What Tasty Food\", restaurant),\n           restaurant = ifelse(restaurant == \"ATAS\", \"ATAS at The RuMa Hotel & Residences\", restaurant), \n           restaurant = ifelse(restaurant == \"Al Rawsha Restaurant Kuala Lumpur\", \"Al Rawsha Restaurant\", restaurant), \n           restaurant = ifelse(restaurant == \"Aliyaa\", \"Aliyaa Island Restaurant & Bar\", restaurant), \n           restaurant = ifelse(restaurant == \"Arthur's Bar & Grill, Shangri-La Hotel, Kuala Lumpur\", \n                               \"Arthur's Bar & Grill\", restaurant), \n           restaurant = ifelse(str_detect(restaurant, \"Lemon Garden\"), \n                               \"Lemon Garden\", \n                               restaurant), \n           restaurant = ifelse(str_detect(restaurant, \"Din Tai Fung at The Gardens Mall\"),\n                               \"Din Tai Fung at The Gardens Mall\", \n                               restaurant), \n           restaurant = ifelse(restaurant == \"Monnalisa Italian Restaurant\", \n                               \"Monnalisa Ristorante Italiano\", \n                               restaurant), \n           restaurant = ifelse(str_detect(restaurant, \"Fatty Mee Hoon Kuih\"), \n                               \"Fatty Mee Hoon Kuih\", \n                               restaurant), \n           restaurant = ifelse(str_detect(restaurant, \"Whisky Bar KL\"), \n                               \"The Whisky Bar\", \n                               restaurant), \n           restaurant = str_replace_all(restaurant, \"W XYZ\", \"WXYZ\"), \n           restaurant = ifelse(restaurant == \"The Daily Grind Bangsar\", \n                               \"The Daily Grind\", \n                               restaurant), \n           restaurant = ifelse(restaurant == \"Chili's 1 Utama\", \"Chili's\", restaurant), \n           restaurant = str_replace_all(restaurant, \"Merini\", \"Marini\"))  |>\n    mutate(\n      cuisine = case_when(\n        \n        # The order of the case_when statements is important. Particularly, it should go\n        # South Asian -> Buffet -> Fusion,\n        # This is because I would consider South Asian buffet restaurants as South Asian.\n        # And I would not consider hotel buffets to be a type of fusion restaurant, \n        # despite all the types of food they might serve.\n        # Also, Grill before Bar.\n        \n          str_detect(\n          restaurant,\n          \"Grill|Steakhouse|Grub|Steak|Brasserie|steakhouse|BBQ|Rock Salt Restaurant|BBP|Churrascaria|Marble 8|Beast|Nando's|Nandos|Bar B Q|Down to Bones|Barbecue|Vantador|Bbq|Butcher Carey|PRIME|Brasserie|Karnivormalaya|Chamber's\"\n        ) ~ \"Grill\",\n          str_detect(restaurant,\n          \"Bistro|Deli|Secret Recipe|Tujo|Wild Sheep|Antipodean|Coffee|One Half|Blue Room|Awesome Canteen|Botanica|Chili's|Don's Diner|GravyBaby|Hornbill|Huck's|myBurgerLab|Naj & Belle|Tony Roma's|Louisiana|Cor Blimey|4Fingers|Bacon And Balls|POP PIZZA|After Black|Ashley's by Living Food|March Azalea Kitchen|Mighty Monster IPC|Sköhns Canteen|Table9|Rabbit Hole|Williams Corner|Tiki Taka|4 Fingers|Ben's|Souled Out|Suzi's Corner|Fuel Shack Signature|SOULed OUT|TGI Friday|Chilli's|Pigs & Wolf|Ship|Breakfast Thieves|Ante|Morganfield's|Subway|Meat The Porkers|Pan & Tamper|Hubba Mont Kiara|Bacon & Balls|Tate|Gin Ger|Fuel Shack|Jarrod & Rawlins|BreadFruits|Glass Tartines and Tipples|B-Lab|Mighty Monster|Ticklish Ribs|Cozy Corner|Duddha|Fat Brother|Define:food|Tangerine|Sausage & Ribs Shack|Texas Chicken|Coco Fika|Andra By Gula Cakery|D Place|Chef Zubir|Hubz|Maipi Corner|Marrybrown|Meet and Meat|Jibby & Co|Midwest|WhupWhup|Foodilicious Kitchen Shah Alam|Craveat\"\n        ) ~ \"Casual Western\",\n        str_detect(\n          restaurant,\n          \"Chinese|Taiwan|[\\\\p{Han}]|Nam Heong|Dynasty|Putien|Hoi|Gold Dragon|Han Room|Village Duck|Village Roast Duck|Unique|Steamboat|Ah |Roast Pork|Hokkien Mee|Dim Sum|Lai Po Heen|Yun House|Chynna|Li Yen|Shanghai|Lai Foong|Little Penang Kafé|Goon Wah|Shang Palace|YEN|Yut Kee|Din Tai Fung|Dragon-i|Celestial Court|The Ming Room|Sai Woo|Luk Yu|Yue|Way Modern Chinois|Hong Kong|Blue Boy Vegetarian Food Centre|Xin|Lai Ching Yuen|Noble House|Noodle House|Bak Kut|Fong Lye|Wan Tan Mee|Sarawak Laksa|Hakka|Ruyi & Lyn|Chicken rice|Chicken Rice|Char Siew|Siew Yoke|Dim Sum|Chiu Chow|Hainan|Hailam|Pork Noodles|Koong Woh Tong|Yong Tow Foo|Madam Tang| Kee|The Pot KL|Yu Noodle Cuisine|Wan Chun Ting|Muk Koot|Oversea|Marco Polo|Cu Cha Restaurant|Imperial|Grand Harbour|In Colonial Restaurant|Museum Restaurant|Heng|Hiong Kong|Ban Lee Restaurant|Heong|Restaurant Mama Love|Hee Lai Ton|New Paris|Kingdom Palace|Siu Siu|Sam You|Ti Chen|Mee Hoon|Fishball|Peoh|Esquire|Restourant Boston|7th Mile Kitchen\"\n        ) ~ \"Chinese\",\n        str_detect(\n          restaurant,\n          \"Italia|Olive|Ristorante|Osteria|Prego|Pizza|Trattoria|Nero Nero|Positano|a'Roma|Vin's Restaurant|Michelangelo|Marini's|Nizza|Porto Romano|Tatto|Neroteca|La Risata|Portofino|Ciao|Enoteca|Mangiare|Sassolino|Pizzeria|La Casa Restaurant & Patisserie|Favola|Senja Restaurant|Graze\"\n        ) ~ \"Italian\",\n        str_detect(\n          restaurant,\n          \"German|French|Chez|Marta's|Tapas|Bistro à Table|Iberico|El Toro Loco|Petit|Mercat|Dominic|El Cerdo|Quivo|Skillet KL|iberico|Yeast|Maison Francaise|El Mesón|Lafite|Topshelf|Wurst|Sabayon|Chateau|Naughty Babe Dirty Duck|Hit & Mrs|Le Gourmandin|Soleil|Suisse|IKEA|Leonardo|MARCO Creative Cuisine|Abanico|La Belle Saison\"\n        ) ~ \"European\",\n        str_detect(restaurant, \"Thai|Bangkok|BKK|Baan|Tamarind Springs|Chakri|BAAN|Samira by Asian Terrace|Ekkamai|Busaba|Mamasan|Krung Thep|Tomyam|Aroma Restaurant|Chef Korn|Tuk Tuk\"\n                   ) ~ \"Thai\",\n        str_detect(restaurant, \"Arab|Turkish|Al-|Halab|Egyptian|Tarbush|Wadi|Sahara Tent|Shawarma|Damascus|Syria|Hadramawt|diafah|Iraq|Sarifa|Al Rawsha|The Castle Restaurant|Saba Restaurant|Marhaba|ALRAWSHA Restaurant|Antara|Andalus|El Sham|Oregi Restaurant\"\n                   ) ~ \"Levantine\",\n        # Malay (Chef Wan) and Malaysian (Madan Kwan's)\n        str_detect(\n          restaurant,\n          \"Malay|Rasa|Cik|Dapur|Rebung|Zakhir|Village Park|ADU|Warisan|Nasi|Dancing Fish|Sarang|Bijan|Serai|Sambal|ATAS|Grandmama's|Onde Onde|JP teres|Satay Station|Chef Wan|De.Wan|Siti Li Dining|Pintu|Ramly|Penyet|Sepiring|Satay|Restoran Ali Food Corner|Open House|Sup Utara|Bawal Power|Ikan|Gulai|Kampung Mu|Marlina Station|Wong Solo|Bawang|Goreng\"\n        ) ~ \"Malay\",\n        str_detect(\n          restaurant,\n          \"Nonya|Baba|Mum's Place|Madam Kwan|Chuup|Old China Cafe|Nyonya|Little Penang|Oriental Cravings|Papparich|Uncle Don|Muar Restaurant|Kumi|Peranakan|1919 Restaurant|Penang\"\n        ) ~ \"Malaysian\",\n        str_detect(\n          restaurant,\n          \"Japan|Edo|Sushi|Kampachi|Iketeru|Menya|Nobu|Omakase|TOKYO|Tokyo|Tonkatsu|Udon|Soba|Ichibanya|Maruhi|Omulab|Zipangu|Miyabi|Izakaya Hanazen|hokkaido|Senya|IPPUDO|Umai-Ya|Ichiban|Yakiniku|Nihon|Lucky Tora|Hokkaido|Mo-Mo Paradise|Sushi|sushi|Uokatsu|Ramen|Tempura|Izakaya|Tokyo|Kyoto|Oishii|Gyoza|Ichiban|Tonkotsu|Tonkatsu|Sakura|Yakitori|Kyush|Teppanyaki|Taka|Kikubari|Ichiyutei|Enju|Okonomi|Toridoki|Syokudo|Tsukiji|Yuzu|Madam Salma|Fu-Rin\"\n        ) ~ \"Japanese\",\n        # Why not merge all Korean BBQ into grill?\n        str_detect(\n          restaurant,\n          \"Filipino|Bali|Vietnam|GOODDAM|Korea|Sao Nam|Naughty Nuri's|KyoChon|Viet|Dakgalbi|Sopoong|Kung Jung|Saigon|Sae Ma Eul|KoRyo-Won|Koryowon|Persia|Astana|Buns & Noodles|Kyochon|Topokki\"\n        ) ~ \"Other Asian\",\n        \n        # Do not str_detect(.x, \"bar\")\n        str_detect(restaurant, \"Whisky|Lounge|Bar|Decanter|Knowhere Bangsar|The Locker & Loft|Tom, Dick & Harry's|WET|The Enclave|Out of Africa|Opium|THIRTY8|Healy Mac's|TEMPTationS|Loco bar|La Bodega|Vertigo|The Social|No Black Tie|The BAR|O'Galito|Table 23|D Legends bar|Bobo KL|Rock Bottom|twenty-one kitchen+bar|Bentley's Pub|Vinh City Entertainment|twenty-one|Malones|White Horse Tavern|Supperclub KL|Backyard|The Ceylon bar|W1 Dining & Cocktails|Splash|Drop Exchange|Boardwalk|Deep Blue|The Sticky Wicket|OneSixFive|The Attic|Concubine KL|The Green Man|THE BAR|Marini’s on 57|Rooftop 25\"\n        ) ~ \"Bar\",\n        str_detect(restaurant, \"Cafe|Grind|Café|Tujo|cafe|Alexis|The Loaf|Yellow Brick Road|Huckleberry|TWG|Newens Tea House|Miss Ellie Tea House|Frisky Goat|Urbean|Ra-Ft|Backofen|STG Bukit Ceylon|VCR|Rise & Shine by Tapestry|Kafe|Kaffe|Kopi|Latte|Kopitiam\"\n        ) ~ \"Cafe\",\n        str_detect(\n          restaurant,\n          \"Kerala|India|Lanka|Malabar|Curry|Raju|Bhavan|Thosai|Tandoor|Bombay|Gem Restaurant|Nasi Kandar|NADODI|Qureshi|RSMY|Sangeetha|Nirwana|Asian Rice Pot|Masala|Annalakshmi|Aliyaa|MTR|Devi's Corner|WTF - What Tasty Food|Nadodi|Delhi Royale|FLOUR|Bakti Woodlands|Vishal Food|Banana Leaf|Hyderabad|sarvana bhavan|Spice Garden|Roti|TasteBud|Chapati|Pakistani|Jai Hind|BananaBro|Naan|SK Corner|Sri Paandi|Majapahit|Nan |GinRikSha|Briyani|Biryani|Maju Palace|Seetharam|Havelly|Punjab|Goa By Sapna Anand|Swaadisht|Mamak|Sri|Chapathi|Moghul|Rani|Aryan|Yarl|Sagar|ABC Foods Corner|Sheesh Mahal|Mallikas\"\n        ) ~ \"South Asian\",\n        \n        # Buffet list\n        restaurant %in% trip_buffet_list ~ \"Buffet\",\n        restaurant %in% google_buffet_list ~ \"Buffet\", \n        str_detect(restaurant, \"Flock, W Kuala Lumpur|HYdeout By Grand Hyatt Kuala Lumpur|Curate\"\n                   ) ~ \"Buffet\", \n        # List of fusion restaurants\n        restaurant %in% trip_fusion_list ~ \"Fusion\",\n        restaurant %in% google_fusion_list ~ \"Fusion\", \n        str_detect(restaurant, \"Symphony by Chef Jo|Darren Chin|Dewakan|DC Restaurant|Sitka|Ginger Restaurant|Table & Apron|Foodsbury\"\n                   ) ~ \"Fusion\", \n        \n        # Unfortunate, there aren't enough Latino restaurants for their own category\n        str_detect(restaurant, \"Latino|Mexican|Carretas|Mexico|Frontera|Mexicana|Cocina\"\n        ) ~ \"Other\",\n        str_detect(restaurant, \"Oliver Gourmet|Seafood|Shell Out|BAIT|Fisherman|Fish & Co|Shucked|Delay No More Crab Restaurant|Ombak\"\n        ) ~ \"Seafood\",\n        str_detect(restaurant, \"Vasco's|Latest Recipe|Lemon Garden|Prime|Gastro Sentral|Chinoz On The Park|Shook|Plane In The City|Contango|The Living Room|Curate At Four Seasons|Beta KL|CEDAR on 15|The Apartment|The Grand Getaway|Strato|Ril's|Chocha|Wizards at Tribeca|Nipah|Joloko|Leonardo's Dining Room & Wine Loft|Roofino Skydining|Troika|Dining In The Dark KL|PLOY|Atlas Gourmet Market|WIP|Nathalie Gourmet Studio|Altitude|The Canteen by Chef Adu|Latitude 03|The Orchid Conservatory|Graze Restaurant|Zende Restaurant|Crystal|Cielo KL|Cedar On 15\"\n        ) ~ \"Other Upmarket\",\n        # Just mopping up all the Dai Chow\n        # I feel this is going to create problems down the line\n        str_detect(restaurant, \"Restoran\"\n        ) ~ \"Chinese\",\n        TRUE ~ \"Other\"\n  )) |> \n    mutate(rowid = row_number())\n}\n\n\n```\n\n\n```{r trip-kl-cuisine and google-kl-cuisine}\ntrip_kl_cuisine <- trip_reviews |> \n  filter(location %in% c(\"KL\", \"Petaling Jaya\", \"Shah Alam\")) |> \n  reviews_cuisine_cleaning() \n\ngoogle_kl_cuisine <- google_reviews |> \n  filter(location %in% c(\"KL\", \"Petaling Jaya\", \"Shah Alam\")) |> \n  reviews_cuisine_cleaning()\n\ntrip_kl_cuisine |> write_csv(\"./data/trip_kl_cuisine.csv\")\n\ngoogle_kl_cuisine |> write_csv(\"./data/google_kl_cuisine.csv\")\n\nsummary_stats <- rbind(\ntrip_kl_cuisine |>\n  mutate(count = 1) |> \n  group_by(restaurant) |> \n  mutate(reviews = sum(count)) |> \n  ungroup() |> \n  filter(reviews >= 20) |> \n  summarise(mean_rating = mean(rating), \n            median_rating = median(rating), \n            mode_rating = Mode(rating)) |> \n  mutate(source = \"Trip Advisor\"),\n\ngoogle_kl_cuisine |>\n  mutate(count = 1) |> \n  group_by(restaurant) |> \n  mutate(reviews = sum(count)) |> \n  ungroup() |> \n  filter(reviews >= 20) |> \n  summarise(mean_rating = mean(rating), \n            median_rating = median(rating),\n            mode_rating = Mode(rating)) |> \n  mutate(source = \"Google\")\n)\n```\n\n<br><br><br>\n\n## Comparisons of average ratings\n\nWith reference to the histograms below, that ratings are skewed towards the higher end: the mean rating of restaurants on Google is **`r summary_stats |> filter(source == \"Google\") |> pull(mean_rating) |> round(2)`** and the mean rating on Trip Advisor is **`r summary_stats |> filter(source == \"Trip Advisor\") |> pull(mean_rating) |> round(2)`**. The median and mode for both datasets is **5**.  \n\nIt really could be said that the default review rating is five stars. This means that restaurant reviews on these platforms are quite lenient. It is hard for me to believe that half of all reviews were about truly exceptional dining experiences: **`r round(google_kl_cuisine |> filter(rating == 5) |> nrow() / nrow(google_kl_cuisine) * 100, 2)`%** of all ratings in the Google dataset for the Klang Valley (KL, PJ and Shah Alam in the datasets) are five stars; in Trip Advisor, it was **`r round(trip_kl_cuisine |> filter(rating == 5) |> nrow() / nrow(trip_kl_cuisine) * 100, 2)`%**. \n\n<br>\n\n```{r compare-mean-ratings-histogram}\ncompare_histograms <- function(tbl){\n  tbl |> \n    mutate(count = 1) |> \n    ggplot(aes(x = rating, y = count)) + \n    geom_col(fill = \"#6a994e\") + \n    scale_y_continuous(labels = comma) + \n    labs(y = \"Number of reviews\", \n         x = \"Rating/Stars\")\n}\n\ngoogle_kl_cuisine |> \n  compare_histograms() +\n  labs(title = \"Google ratings\") +\n  coord_flip() +\n\ntrip_kl_cuisine |> \n  compare_histograms() +\n  labs(title = \"TripAdvisor ratings\") + \n  coord_flip() +\n  \n  plot_annotation(\n    title = \"Similar distributions of review ratings in Google and Trip Advisor\",\n    subtitle = \"Only includes restaurants in the Klang Valley.\"\n  )\n\nggsave(\"./plots/ratings_summary.png\", height = 4, width = 7, units = \"in\")\n```\n\n<br>\n\nReviews are limited (in every sense of the word) to a one-to-five scale. In the scatterplots below, we note that **almost all restaurants mostly receive five stars (blue) or four stars (green)**. This does seem to indicate that restaurant ratings are not very good at distinguishing between restaurants. \n\n\n<br>\n\n\n```{r restaurant-comparison-trip-google, warning=FALSE, message=FALSE}\n\ncompare_google_trip <- function(tbl){\n  \n  tbl |> \n    group_by(restaurant, cuisine) |> \n    summarise(reviews = n(), \n              mean_rating = mean(rating), \n              median_rating = median(rating), \n              mode_rating = Mode(rating),\n              .groups = \"drop\") |>  \n    filter(reviews >= 20)\n  }\n\nplot_google_trip <- function(tbl){\n  \n  tbl |> \n    ggplot(aes(x = reviews, \n               y = mean_rating)) +\n    geom_point(aes(colour = median_rating), \n               alpha = .4) + \n    # scale_size_continuous(limits = c(1, 10)) +\n    scale_x_log10(labels = comma) +\n    scale_colour_viridis(option = \"turbo\", begin = .15, end = .9, direction = -1, \n                         labels = label_number(accuracy = .1)) +\n    # ggrepel::geom_text_repel(aes(label = cuisine)) + \n    geom_smooth(method = \"lm\", alpha = .1, size = 0, span = .5) + \n    geom_smooth(method = \"lm\", se = FALSE, alpha = .1, size = .2) + \n    labs(subtitle = \"Restaurants with less than 20 reviews excluded\", \n         x = \"Number of reviews\",\n         y = \"Mean Rating\",\n         colour = \"Median Rating\") +\n    theme(legend.title = element_text(size = 9), \n          legend.text = element_text(size = 7),\n          legend.key.size = unit(0.9, \"lines\"))\n    \n}\n  \n\ngoogle_kl_cuisine |> \n  compare_google_trip() |> \n  plot_google_trip() + \n  # ylim(3.8, 4.6) +\n  labs(title = \"Google reviews\") +\n  guides(size = guide_legend(override.aes = list(alpha = 1))) +\n\ntrip_kl_cuisine |> \n  compare_google_trip() |> \n  plot_google_trip() + \n  # ylim(3.8, 4.6) +\n  labs(title = \"Trip Advisor reviews\") +\n  guides(size = \"none\") +\n  \n  plot_annotation(title = \"Klang Valley restaurants and average ratings\") +\n  plot_layout(guides = \"collect\") & theme(legend.position = \"bottom\")\n\nggsave(\"./plots/cuisine_comparison_trip_google.png\", height = 7, width = 11, units = \"in\")\n\n```\n\n<br><br><br>\n\n\n## Adding cuisine\n\nThese are the columns present in the Google dataset: \n\n```{r}\ngoogle_reviews |> \n  colnames() \n\n```\n\nTrip Advisor has additional columns for `review title` and `date`. \n\nLet's add a column for cuisine (the code can be downloaded at the top of the page, but it was a lot of manual work) to increase interpretability and to maximise the usefulness of the data. We'll narrow down the scope to locations in the Klang Valley (KL, PJ and Shah Alam, in the datasets; since I'm most familiar with and most interested in this metro).  \n\nDetermining the cuisine of a restaurant was mostly fairly obvious, and the categories hopefully self-explanatory. Additional notes on the coding of these cuisines may be found in the appendices. \n\nLet's start first with an overview of both datasets, now with cuisines included. From the plot below, we see that: \n\n* South Asian, Chinese, Casual Western, Japanese and Bars are the most commonly-reviewed restaurants in the Klang Valley. These are not the most common nor the most commonly-visited restaurants (hawker stalls).  \n\n* Chinese, Casual Western, Malaysian and Thai are the lowest-rated cuisines. \n\n* Fusion, Other Upmarket (experiential dining or unspecified \"international\" cuisine) and bars have the highest ratings, with 60% or more of all reviews being five stars. \n\n* Trip Advisor and Google reviewers differ the most on their opinions of Levantine, Casual Western and Japanese restaurants. With regards to Levantine food, in my opinion at least, it might be a case of \"good for Malaysia\", but not necessarily good compared to outside of it. \n\n* The x-axes on the plots below show the percentage of reviews that are five stars by cuisine. This actually provides much more differentiation than just the mean rating (which is reflected in the colours below).  \n\n\n<br>\n\n\n```{r cuisine-comparison-barchart, fig.width=7}\n\ngoogle_kl_cuisine |> \n  mutate(count = 1) |> \n  group_by(cuisine) |> \n  summarise(reviews = n(), \n            five_star_reviews = sum(count[rating == 5]), \n            mean_rating = mean(rating)) |> \n  mutate(five_star_pc = five_star_reviews / reviews, \n         source = \"Google\")|> \n  select(five_star_pc, cuisine, source, reviews, mean_rating) |> \n  rbind(\n    trip_kl_cuisine |> \n      mutate(count = 1) |> \n      group_by(cuisine) |> \n      summarise(reviews = n(), \n                five_star_reviews = sum(count[rating == 5]), \n                mean_rating = mean(rating)) |> \n      mutate(five_star_pc = five_star_reviews / reviews, \n             source = \"Trip Advisor\") |> \n      select(cuisine, five_star_pc, source, reviews, mean_rating)\n  ) |> \n  ggplot(aes(x = five_star_pc, \n             y = fct_reorder(cuisine, mean_rating), \n             fill = mean_rating)) + \n  geom_col(alpha = .7) + \n  scale_x_continuous(labels = percent) +\n  geom_text(aes(label = comma(reviews)), \n            position = position_dodge(width = .9), \n            hjust = \"inward\", \n            colour = \"grey20\") + \n  scale_fill_viridis(direction = -1, begin = .2) +\n  facet_wrap(~ source) + \n  theme(strip.background = element_rect(fill = \"black\"), \n        strip.text = element_text(face = \"bold\"),\n        legend.title = element_text(size = 9), \n          legend.text = element_text(size = 7),\n          legend.key.size = unit(0.9, \"lines\")) +\n  labs(x = \"% of reviews that are five-stars\", \n       y = \"\", \n       title = \"% of reviews that are five stars on Google and Trip Advisor, by cuisine\", \n       subtitle = \"Only restaurants in the Klang Valley. Total number of reviews at the end of each bar.\", \n       fill = \"Mean\\nrating\")\n  \n\n```\n\n<br><br><br>\n\n\n\n## Restaurants in both Google and Trip\n\nLet's investigate a bit more by looking at restaurants that appear in both the Google and Trip datasets. \n\nBelow, we have plotted restaurants based on their mean ratings on Google and Trip Advisor. The globalised nature (with such heavy representation from casual western restaurants) of the Malaysian food scene seems to result in Google (which is used more heavily by locals) and Trip Advisor (which is used more often by travellers) agreeing more than not. \n\nLooking at the top-right quadrant, we see that the restaurants rated most highly by Google and Trip Advisor are mostly fine dining: Sushi Hibiki is a high-end omakase restaurant and seems to be regarded as the best meal in the Klang Valley; DC Restaurant has one Michelin star. Sausage Kl Cafe and Grill, however, was a restaurant specialising in full English breakfast. And Antipodean is a cafe that is, to me, a solid 3.5/5; but it still has around the same Trip Advisor rating as Dewakan, which has two Michelin stars. \n\nWe'll look into this more in next week's section of the report, but it appears that the commonality of five-star reviews indicates that the mean rating might be more an indicator of expectations being met, than any true excellence. \n\n\n<br>\n\n```{r restaurant-fuzzy-match, warning=FALSE}\n\nrestaurant_fuzzy_match <- stringdist_join(\n  trip_reviews |> \n    filter(location %in% c(\"KL\", \"Petaling Jaya\", \"Shah Alam\")) |> \n    distinct(restaurant) |> \n    mutate(restaurant_match = str_remove_all(restaurant, \"Restaurant|Cuisine|restaurant|Restoran|Curry House|Japanese\"), \n           restaurant_match = trimws(restaurant_match)) |> \n    select(restaurant_trip = restaurant, \n           restaurant_match), \n  google_kl_cuisine |> filter(location %in% c(\"KL\", \"Petaling Jaya\", \"Shah Alam\")) |> \n    distinct(restaurant)|> \n    mutate(restaurant_match = str_remove_all(restaurant, \"Restaurant|Cuisine|restaurant|Restoran|Curry House|Japanese\"),\n           restaurant_match = trimws(restaurant_match)) |> \n    select(restaurant_google = restaurant, \n           restaurant_match), \n  by = \"restaurant_match\", \n  ignore_case = TRUE, \n  method = \"jw\",\n  max_dist = 99, \n  distance_col = \"dist\"\n) |> \n  group_by(restaurant_match.x) |> \n  slice_min(order_by = dist, n = 1) |> \n  arrange((dist)) |> \n  select(match_x = restaurant_match.x, \n         match_y = restaurant_match.y, \n         dist,\n         restaurant_google, \n         restaurant_trip) |>\n  ungroup()\n\nboth_google_and_trip <- restaurant_fuzzy_match |> \n  filter(match_x != \"Teh Laris Cafe\" | match_y != \"Thosai Cafe\") |> \n  filter(match_x != \"The Ming Room\" | match_y != \"The Living Room\") |>\n  filter(match_x != \"Cilantro & Wine Bar\" | match_y != \"ZENZERO & Wine Bar\") |> \n  filter(match_x != \"Kedai Kopi Pak Ngah\" | match_y != \"Kedai Kopi Lai Foong\") |> \n  filter(match_x != \"Shanghai\" | match_y != \"Old Shanghai\") |> \n  filter(match_x != \"Ah Ni Bak Kut Teh\" | match_y != \"Ah Sang Bak Kut Teh\") |> \n  filter(match_x != \"Pin Wei Seafood\" | match_y != \"Hoi Peng Seafood\") |> \n  filter(match_x != \"Cafe Cafe\" | match_y != \"Cafe ETC\") |> \n  filter(match_x != \"Tao Chinese\" | match_y != \"Ee Chinese\") |>\n  filter(match_x != \"Seoul Garden\" | match_y != \"Lemon Garden\") |>\n  filter(match_x != \"De.Wan\" | match_y != \"Dewakan\") |>\n  filter(dist <= 0.16666667)\n\ncombined_google_trip <- trip_kl_cuisine |> \n  filter(restaurant %in% both_google_and_trip$restaurant_trip) |> \n  select(cuisine, location, restaurant, rating, review) |>\n  mutate(source = \"TripAdvisor\") |> \n  rbind(\n    google_kl_cuisine |> \n      filter(restaurant %in% both_google_and_trip$restaurant_google) |> \n      select(cuisine, location, restaurant, rating, review) |> \n      mutate(source = \"Google\")\n  ) |> \n  mutate(row_id = row_number()) |> \n  left_join(\n    both_google_and_trip |> \n      distinct(restaurant_google, restaurant_trip) |>\n      rename(restaurant = restaurant_trip),\n    by = c(\"restaurant\")\n  ) |> \n  left_join(\n    both_google_and_trip |> \n      distinct(restaurant_google, restaurant_trip) |>\n      rename(restaurant = restaurant_google),\n    by = c(\"restaurant\")\n  ) |> \n  mutate(restaurant_new = ifelse(!is.na(restaurant_google), \n                                 restaurant_google, \n                                 restaurant)) |> \n  group_by(row_id, location, cuisine, restaurant = restaurant_new, review, source) |> \n  summarise(rating = mean(rating), \n            .groups = \"drop\") |> \n  mutate(restaurant = trimws(restaurant))\n\n```\n\n\n\n```{r common-restaurants, fig.height=8, fig.width=10, eval=FALSE}\n\n# Putting in the finished plot, instead of evaluating again\n# so that I can embed a link to the full-size plot in the image\n\ncombined_google_trip |> \n  group_by(restaurant, source) |> \n  summarise(rating = mean(rating), \n          .groups = \"drop\") |> \n  pivot_wider(names_from = source, \n              values_from = rating) |> \n  left_join(\n    combined_google_trip |> \n      count(restaurant, \n            name = \"count\"), \n    by = \"restaurant\"\n  ) |> \n  left_join(\n    combined_google_trip |> \n      distinct(restaurant, cuisine), \n    by = \"restaurant\"\n  ) |> \n  filter(!is.na(Google) & !is.na(TripAdvisor)) |> \n  ggplot(aes(x = Google, y = TripAdvisor)) + \n  geom_smooth(alpha = .1, size = 0, span = .5, \n              method = \"lm\") + \n  stat_smooth(geom = \"line\", alpha = .1, size =.5, span = .5, \n              method = \"lm\") +\n  geom_point(aes(colour = cuisine, \n                 size = count)) + \n  scale_colour_viridis_d(option = \"turbo\") +\n  ggrepel::geom_text_repel(aes(label = restaurant), \n                           size = 1.2) + \n  labs(title = \"Comparison between Google and TripAdvisor restaurant ratings\", \n       subtitle = \"Size indicates number of reviews\", \n       y = \"Trip Advisor mean rating\", \n       x = \"Google mean rating\", \n       colour = \"Cuisine\", \n       size = \"Review count\") + \n  # guides(colour = guide_legend(override.aes = list(size = .7))) +\n  theme(legend.title = element_text(size = 6), \n        legend.text = element_text(size = 6), \n        legend.key.size = unit(0.3, \"lines\"))\n\nggsave(\"./plots/restaurant_comparison_trip_google.png\", height = 9, width = 11, units = \"in\")  \n```\n\n[![Click image for full size](./plots/restaurant_comparison_trip_google.png)](https://github.com/AIMdata-org/google_trip_reviews_kl_site/raw/main/plots/restaurant_comparison_trip_google.png)\n\n<br>\n\nWhat becomes clearer when we re-plot the restaurants, this time using percentage of ratings that are five stars, the distinction between fine dining and more casual restaurants is much clearer. Fine dining restaurants tend to have above 50% of their reviews being five stars in both Trip and Google.  \n\nThe restaurants in the \"fine dining\" group have higher floors and ceilings, when it comes to the percentage of ratings that are five stars. This is why lacking price range in this dataset is such a shame, as it seems like these two groups should be graded on their own curves.\n\nWe also see how Google reviewers are stricter (less lenient), with restaurants struggling to get above 70% five-star reviews. Though, as mentioned this isn't any particular mark of quality. \n\nAlso to be investigated further is to what extent restaurants in the \"fine dining\" achieve their higher scores due to better service and environments, as opposed to food quality. \n\n\n<br>\n\n```{r new-rating-common-restaurants, fig.height=8, fig.width=10, warning=FALSE, eval=FALSE}\n\n# Putting in the finished plot, instead of evaluating again\n# so that I can embed a link to the full-size plot in the image\n\ncombined_google_trip |> \n  mutate(new_rating = ifelse(rating %in% c(5), 1, 0)) |> \n  group_by(restaurant, source) |> \n  summarise(new_rating = mean(new_rating), \n            .groups = \"drop\") |> \n  pivot_wider(names_from = \"source\", \n              values_from = new_rating) |> \n  left_join(\n    combined_google_trip |> \n      count(restaurant, \n            name = \"count\"), \n    by = \"restaurant\"\n  ) |> \n  left_join(\n    combined_google_trip |> \n      distinct(restaurant, cuisine), \n    by = \"restaurant\"\n  ) |> \n  filter(!is.na(Google) & !is.na(TripAdvisor)) |> \n  ggplot(aes(x = Google, y = TripAdvisor)) + \n  geom_smooth(alpha = .1, size = 0, span = .5) + \n  stat_smooth(geom = \"line\", alpha = .1, size =.5, span = .5) +\n  geom_point(aes(colour = cuisine, \n                 size = count)) + \n  scale_colour_viridis_d(option = \"turbo\") +\n  ggrepel::geom_text_repel(aes(label = restaurant), \n                           size = 1.2) + \n  scale_x_continuous(labels = percent, breaks = c(0, 0.2, 0.3, 0.4, 0.5, \n                                                  0.6, 0.7, 0.8, 0.9, 1), \n                     limits = c(0.2, .87)) + \n  scale_y_continuous(labels = percent, breaks = c(0, 0.2, 0.3, 0.4, 0.5, \n                                                  0.6, 0.7, 0.8, 0.9, 1), \n                     limits = c(0.2, .94)) +\n  scale_size_continuous(breaks = c(100, 500, 1000, 2000)) +\n  labs(title = \"Comparison between Google and TripAdvisor using percentage of 5-star reviews\", \n       subtitle = \"Size indicates number of reviews.\", \n       y = \"% of 5-star ratings, Trip Advisor\", \n       x = \"% of 5-star ratings, Google\",\n       caption = \"Sources: Google; TripAdvisor; Ng Choon Khon.\",\n       colour = \"Cuisine\", \n       size = \"Review count\") + \n  # guides(colour = guide_legend(override.aes = list(size = .7))) +\n  theme(legend.title = element_text(size = 6), \n        legend.text = element_text(size = 6), \n        legend.key.size = unit(0.3, \"lines\"))\n\nggsave(\"./plots/restaurant_comparison_new_ratings2.png\", height = 9, width = 11, units = \"in\")  \n```\n\n[![Click image for full size](./plots/restaurant_comparison_new_ratings2.png)](https://github.com/AIMdata-org/google_trip_reviews_kl_site/raw/main/plots/restaurant_comparison_new_ratings2.png)\n\n<br><br><br>\n\n## Conclusions: Part one\n\nLet's review what we've learnt so far; though we probably already knew some of these things instinctually, it is still nice to get confirmation: \n\n* Reviews skew very heavily towards five stars. More than half of all reviews give five stars. This means that Google Maps and TripAdvisor are not useful in determining where one should eat since five stars could mean anything from \"met expectations\" to \"truly exceptional\". \n\n* Re-sorting (lowest, most recent) and filtering reviews will likely provide more informative reviews on Google. There is no real reason to accept their default sorting by \"relevance\" as you can pay for visibility, pay for reviews, and pay to remove reviews.\n\n* However, this means that we're still engaging with reviews as individual data points. Even looking at the review summary will not always be helpful, since having five-star reviews be less than 50% of your total is more an indicator that the restaurant is not fine dining, than any other indicator of quality. \n* Outside of the home, hawker centres and coffee shops are places where food is most commonly consumed. Yet these businesses are not reviewed with anywhere the same frequency as the casual western eateries or chinese restaurants/*dai chows*. It is difficult (by design?) to mark individual hawkers since they operate from within the premises of another business. Additionally, hawkers are much less likely to engage with Google or Trip Advisor to curate or market their online presence, leading to these platforms being blind to the needs of hawkers and continue to cater towards restaurants (who might actual have marketing budgets).\n\nRare is the occasion that I, whilst searching on Google or Trip Advisor, find a truly exceptional meal. My most memorable experiences have mostly been the result of personal recommendations or curated lists from trusted reviewers. I'm starting to think that the main purpose of review platforms is marketing. \n\n<br><br><br>\n\n## Appendices\n\n### Notes on cuisine\n\nWith reference to the cleaning script for determining the cuisine of a restaurant, there are few things to bear in mind in trying to update or improve it. \n\nI have made a distinction between Malay and Malaysian cuisines. This difference can be boiled down to Chef Wan (Malay) vs. Madan Kwan (Malaysian). A Hainan Kopitiam would be considered as Malaysian. \n\nA few more points for the ordering of arguments within the `case_when` statement: \n\n\"Other Upmarket\" is mostly expensive experiential dining, with some tourist traps. In this category are *Dining in the Dark* and *Plane in KL*. I've also included Turkish food under the \"Levantine\" umbrella.\n\n\"Fusion\" restaurants are explicitly fusion restaurants, with the word \"fusion\" in their names or showing up in a proportion of reviews. The same is true for buffet restaurants (which were numerous enough in the Trip Advisor dataset to warrant their own category). \n\nI have considered South Asian buffet restaurants to be South Asian restaurants. I And I do not consider hotel buffets to be a type of fusion restaurant, despite all the types of food they might serve. Additionally, when altering the cleaning script, make sure that the argument for grills is before that for bars (because of \"barbecue\"). \n\nThe Google and Trip Advisor datasets for the Klang Valley have a fairly comparable number of reviews: `r google_kl_cuisine |> nrow() |> format(big.mark = \",\")` in Google and `r trip_kl_cuisine |> nrow() |> format(big.mark = \",\")` in Trip Advisor. \n\n<br>\n\n```{r reviews-by-cuisine, fig.height=6.5}\ncuisine_intermediate <- trip_kl_cuisine |> \n  count(cuisine, sort = TRUE, name = \"trip_reviews\") |> \n  left_join(\n    google_kl_cuisine |> \n      count(cuisine, sort = TRUE, name = \"google_reviews\")\n  ) |> \n  mutate(\n    total_reviews = trip_reviews + google_reviews\n  ) |> \n  arrange(desc(total_reviews)) \n\ncuisine_intermediate |> \n  pivot_longer(cols = c(trip_reviews, google_reviews, total_reviews), \n               names_to = \"source\", \n               values_to = \"count\") |> \n  mutate(source = str_replace_all(source, \"_reviews\", \"\"), \n         source = str_to_title(source),\n         source = str_replace_all(source, \"Trip\", \"Trip Advisor\")) |> \n  mutate(source = factor(source, levels = c(\"Google\",\n                                            \"Trip Advisor\",\n                                            \"Total\"))) |> \n  ggplot(aes(x = count, y = fct_rev(fct_relevel(cuisine, cuisine_intermediate |> pull(cuisine))))) + \n  geom_col(aes(fill = cuisine)) +\n  geom_text(aes(label = comma(count)), \n            position = position_dodge(width = .9), \n            hjust = \"inward\", \n            colour = \"grey20\", \n            size = 3) +\n  facet_wrap(~source, scales = \"free_x\") + \n  scale_x_continuous(labels = number_format(scale = 1/1000, suffix = \"k\", \n                                            accuracy = 1)) + \n  scale_fill_viridis_d(option = \"turbo\") + \n  theme(legend.title = element_text(size = 8), \n        legend.text = element_text(size = 8), \n        legend.key.size = unit(0.3, \"lines\"), \n        strip.background = element_rect(fill = \"black\"), \n        plot.caption = element_text(hjust = .5)) + \n  labs(x = \"Number of reviews\", \n       y = \"\", \n       fill = \"Cuisine\",\n       title = \"Number of reviews by cuisine\", \n       subtitle = \"Restaurants in the Klang Valley\", \n       caption = \"Sources: Ng Choon Khon; Google; TripAdvisor.\")\n\n  \n```\nTrip Advisor reviewers tended to review far more bars, buffets (including hotel buffets), cafes, fusion, Japanese and unspecified upmarket restaurants than Google reviewers. This is commonsensical since Trip Advisor tends to have travellers using it.\n\n<br><br><br>\n\n### Reference tables\n\nBelow are reference tables for the restaurants used in this analysis. \n\n#### Google: restaurants in the Klang Valley\n\nSorted in descending order, according to mean rating. \n\n```{r dt-google}\ngoogle_kl_cuisine |> \n  select(restaurant, cuisine, rating, location) |> \n  group_by(restaurant, cuisine, location) |> \n  summarise(mean_rating = round(mean(rating), 2),\n            median_rating = median(rating), \n            reviews = n(), .groups = \"drop\") |> \n  filter(reviews >= 20) |> \n  relocate(location, .after = reviews) |> \n  rename(`mean rating` = mean_rating, \n         `median rating` = median_rating) |> \n  arrange(desc(`mean rating`)) |> \n  datatable(filter = list(position = \"top\", clear = \"FALSE\"), \n            options = list(pageLength = 10, scrollX = TRUE), \n            caption = htmltools::tags$caption(\n              style = \n              \"caption-side: top;\n              text-align: center;\n              color: black;\n              font-size: 120% ;\",\n              \"Google: restaurants in the Klang Valley with more than 20 reviews\"\n            )) |> \n  formatStyle(0, target = \"row\", lineHeight = \"85%\", fontSize = \"80%\")\n\n\n```\n\n\n\n<br><br><br>\n\n#### Trip Advisor: restaurants in the Klang Valley\n\nSorted in descending order, according to mean rating. \n\n```{r dt-trip}\ntrip_kl_cuisine |> \n  select(restaurant, cuisine, rating, location) |> \n  group_by(restaurant, cuisine, location) |> \n  summarise(mean_rating = round(mean(rating), 2),\n            median_rating = median(rating), \n            reviews = n(), .groups = \"drop\") |> \n  filter(reviews >= 20) |> \n  relocate(location, .after = reviews) |> \n  rename(`mean rating` = mean_rating, \n         `median rating` = median_rating) |> \n  arrange(desc(`mean rating`)) |> \n  datatable(filter = list(position = \"top\", clear = \"FALSE\"), \n            options = list(pageLength = 10, scrollX = TRUE), \n            caption = htmltools::tags$caption(\n              style = \n              \"caption-side: top;\n              text-align: center;\n              color: black;\n              font-size: 110% ;\",\n              \"Trip Advisor: restaurants in the Klang Valley with more than 20 reviews\"\n            )) |> \n  formatStyle(0, target = \"row\", lineHeight = \"85%\", fontSize = \"80%\")\n\n\n\n\n```\n\n\n\n\n\n\n","srcMarkdownNoYaml":"\n\n\n```{r setup, include = FALSE}\n\nknitr::opts_chunk$set(echo = FALSE, \n                      warning = FALSE, \n                      message = FALSE, \n                      fig.width = 9)\n\n\nlibrary(tidyverse)\nlibrary(here)\nlibrary(janitor)\nlibrary(scales)\nlibrary(tidytext)\nlibrary(widyr)\nlibrary(ggraph)\nlibrary(patchwork)\nlibrary(kableExtra)\nlibrary(fuzzyjoin)\nlibrary(viridis)\nlibrary(textdata)\nlibrary(DT)\n\n`%out%` <- Negate(`%in%`)\noptions(scipen = 100)\ntheme_set(theme_light())\nrange_wna <- function(x){(x-min(x, na.rm = TRUE))/(max(x, na.rm = TRUE)-min(x, na.rm = TRUE))}\n\nMode <- function(x) {\n  ux <- unique(x)\n  ux[which.max(tabulate(match(x, ux)))]\n}\n```\n\n\n```{r data}\ngoogle_reviews <- read_csv(\"./data/GoogleReview_data_cleaned.csv\") |> clean_names()\n\ntrip_reviews <- read_csv(\"./data/TripAdvisor_data_cleaned.csv\") |> clean_names() |> \n  mutate(review = str_replace_all(review, \"dim sum|Dim Sum|Dim sum\", \"dimsum\"))\n```\n\n## Introduction and overview\n\nA common refrain in this postmodern age is that online reviews are useless. \n\nToday, we're looking at two different sets of scraped restaurant reviews to determine to what extent that is true. Restaurant reviews from Google and Trip Advisor in Malaysia were scraped by [Ng Choon Khon](https://www.kaggle.com/datasets/choonkhonng/malaysia-restaurant-review-datasets) using the Selenium library. \n\nBelow, we've plotted out the restaurants found in both datasets according to the number of reviews and their mean rating. Immediately, we note an unnatural pattern in the Google dataset: Google limits Selenium to only being able to scrape around 300 reviews per restaurant, at most.\n\nWhilst this impacts and limits the dataset, we should still make the best use of it we can: Google's official API only allows five reviews to be extracted per restaurant because data freely given to the world must be paywalled and sold back to you.\n\nThis analysis is ultimately meant to better understanding of Google's and Trip Advisor's review platforms from a consumer perspective, in order to choose more satisfactory restaurants. \n\n\n<br>\n\n```{r histogram, fig.width=9}\ngoogle_reviews |> \n  filter(location %in% c(\"Petaling Jaya\", \"KL\")) |> \n  count(restaurant) |> \n  ggplot(aes(x = n)) + \n  geom_histogram(binwidth = 1/30, \n                 fill = \"#6a994e\") + \n  # geom_freqpoly(colour = \"blue\", alpha = .3) +\n  scale_x_log10(breaks = c(0, 10, 30, 100, 300, 1000), \n                labels = comma) + \n  labs(title = \"Google reviews per restaurant\", \n       subtitle = \"Largely limited to 300 reviews per restaurant\",\n       x = \"Number of reviews\", \n       y = \"Number of restaurants\") +\n\ntrip_reviews |> \n  filter(location %in% c(\"Petaling Jaya\", \"KL\")) |> \n  count(restaurant) |> \n  ggplot(aes(x = n)) + \n  geom_histogram(binwidth = 1/30, \n                 fill = \"#6a994e\") + \n  # geom_freqpoly(colour = \"blue\", alpha = .3) +\n  scale_x_log10(breaks = c(0, 10, 30, 100, 300, 1000), \n                labels = comma) + \n  labs(title = \"Trip Advisor reviews per restaurant\", \n       subtitle = \"No limits for number of reviews scraped\",\n       x = \"Number of reviews\", \n       y = \"Number of restaurants\") +\n\n  plot_annotation(\n    title = \"The Trip Advisor reviews dataset has a much more natural distribution\"\n  )\n\n```\n\n<br>\n\n### Limitations\n\n\n```{r malay-list}\n# Maybe someone with a better grasp of Malay can improve on this, \n# without getting too many false positives\n# But it works pretty well as long as the not_malay_list is run as well\n# The number for Trip Advisor is likely lower still, since there were still some false positives\n# Remember that \nmalay_list <- \" yang|sedap|makanan|Makanan| saya| Saya|dulu|semua|kali|sdap|sangat|Sangat|lauk|harga|tapi|terbaik|berbaloi| dgn|siap|tidak|bole|boleh| lain|cantik\"\n\n# Not really that surprising that \"kalian\" is almost always just a mispelling of \"kailan\", \n# But I'll leave it out as it could make too many false negatives\nnot_malay_list <- \"yangzhou|yang zhou|Yang zhou|wayang|Wayang|tapioca|Tapioca|Gansayam|Rasa Saya|ying yang|yin yang|goyang|fried rice|chargable|hargao\"\n\n# Realising now that there is a malaytextr package\n# Remember to fix this\n\nmalay_pc_summary <- rbind(google_reviews |>\n  filter(!is.na(review)) |> \n  mutate(malay = ifelse(\n  str_detect(review, malay_list) & \n    !str_detect(review, not_malay_list), 1, 0)) |> \n  summarise(count = n(), \n            malay = sum(malay)) |> \n  mutate(malay_pc = round(malay / count * 100, 2), \n         source = \"Google\"),\n\ntrip_reviews |> \n  filter(!is.na(review)) |> \n  mutate(malay = ifelse(\n  str_detect(review, malay_list) & \n    !str_detect(review, not_malay_list), 1, 0)) |> \n  summarise(count = n(), \n            malay = sum(malay)) |> \n  mutate(malay_pc = round(malay / count * 100, 2), \n         source = \"TripAdvisor\"))\n\n```\n\n\n\nLet's review the limitations once more, before we look into these datasets: \n\n* What Google's dataset is representative of cannot be readily explained. For many restaurants, only their first 300 most \"relevant\" reviews have been extracted. Google determines \"relevance\" by using a combination of recency, quality (word count, images) and whether or not a review was regarded by the community as helpful. \n\n* Both Google maps and Trip Advisor are principally English language platforms when the language isn't regularly used by the majority of the population. Upon a cursory inspection, there are very few reviews in Malay in Google (`r malay_pc_summary |> filter(source == \"Google\") |> pull(malay_pc)`%) and even less in Trip Advisor (`r malay_pc_summary |> filter(source == \"TripAdvisor\") |> pull(malay_pc)`%). This is extremely different from even urban demographics (where there are proportionally more minorities, and consequently, English speakers). This bias is more understandable on Trip Advisor than it is on Google. \n* The price range is missing from this dataset. This is unfortunate because price is one of the main topics mentioned in reviews. If I were to rescrape the data, I would definitely prioritise getting the price range. \n\n* These reviews were extracted three years ago: some of these restaurants have closed, or have changed how they operate.  \n\n* Whilst reviews themselves are largely meant to informational, expressive or cautionary, review platforms are mired in layers of obfuscation, gamification and marketing. Additionally, Google's reviews are generally less policed than Trip Advisor's, with notable instances of [scams]((https://www.asiaone.com/lifestyle/restaurant-ibid-woo-wai-leong-police-reviews-scam)) and bribed reviews. Additionally, reviews are further affected by prevailing social mores (we discuss the skew towards five stars below). \n\n\n```{r buffet-fusion-lists}\n\ntrip_buffet_list <- trip_reviews |> \n  mutate(possible_buffet = ifelse(\n    str_detect(review, \"Buffet|buffet\") | \n      str_detect(title, \"Buffet|buffet\") |\n      str_detect(restaurant, \"Buffet|buffet\")\n    , 1, 0), \n    count = 1) |> \n  group_by(restaurant) %>% \n  summarise(reviews = sum(count), \n            buffet_count = sum(count[possible_buffet == 1])) |> \n  arrange(desc(buffet_count)) |> \n  mutate(buffet_pc = buffet_count / reviews) |> \n  mutate_at(vars(reviews, buffet_count, buffet_pc), ~range_wna(.)) |>  \n  mutate(buffet_score = (buffet_count + buffet_pc) / 2) |> \n  arrange(desc(buffet_score)) |> \n  filter(buffet_score >= .2) |> \n  pull(restaurant)\n\ntrip_fusion_list <- trip_reviews |> \n  mutate(possible_fusion = ifelse(\n    str_detect(review, \"Fusion|fusion\") | \n      str_detect(title, \"Fusion|fusion\") |\n      str_detect(restaurant, \"Fusion|fusion\")\n    , 1, 0), \n    count = 1) |> \n  group_by(restaurant) %>% \n  summarise(reviews = sum(count), \n            fusion_count = sum(count[possible_fusion == 1])) |> \n  arrange(desc(fusion_count)) |> \n  mutate(fusion_pc = fusion_count / reviews) |> \n  mutate_at(vars(reviews, fusion_count, fusion_pc), ~range_wna(.)) |>  \n  mutate(fusion_score = (fusion_count +  fusion_pc) / 2) |> \n  arrange(desc(fusion_score)) |> \n  filter(fusion_score >= .11) |> \n  pull(restaurant)\n\ngoogle_buffet_list <- google_reviews |> \n  mutate(possible_buffet = ifelse(\n    str_detect(review, \"Buffet|buffet\") | \n      str_detect(restaurant, \"Buffet|buffet\")\n    , 1, 0), \n    count = 1) |> \n  group_by(restaurant) %>% \n  summarise(reviews = sum(count), \n            buffet_count = sum(count[possible_buffet == 1])) |> \n  arrange(desc(buffet_count)) |> \n  mutate(buffet_pc = buffet_count / reviews) |> \n  mutate_at(vars(reviews, buffet_count, buffet_pc), ~range_wna(.)) |>  \n  mutate(buffet_score = (buffet_count + buffet_pc) / 2) |> \n  arrange(desc(buffet_score)) |> \n  filter(buffet_score >= 0.1764) |> \n  pull(restaurant)\n\ngoogle_fusion_list <- google_reviews |>\n  mutate(possible_fusion = ifelse(\n    str_detect(review, \"Fusion|fusion\") |\n      str_detect(restaurant, \"Fusion|fusion\")\n    , 1, 0), \n    count = 1) |> \n  group_by(restaurant) %>% \n  summarise(reviews = sum(count), \n            fusion_count = sum(count[possible_fusion == 1])) |> \n  arrange(desc(fusion_count)) |> \n  mutate(fusion_pc = fusion_count / reviews) |> \n  mutate_at(vars(reviews, fusion_count, fusion_pc), ~range_wna(.)) |>  \n  mutate(fusion_score = (fusion_count +  fusion_pc) / 2) |> \n  arrange(desc(fusion_score)) |> \n  filter(fusion_score >= .11) |> \n  pull(restaurant)\n```\n\n\n\n```{r reviews-cuisine-cleaning}\n\nreviews_cuisine_cleaning <- function(tbl) {\n  \n  tbl |> \n    # Not a specific restaurant\n    filter(restaurant %out% c(\"Jalan Alor\", \"Sham's Cooked With Love\", \"Hawker Stalls in Chinatown\",\n                              \"Feast Village Starhill Gallery\", \"ICC Pudu\", \"Imbi Market\", \n                              \"Taste of Asia\", \"Thirty8 Fashion\", \"Happy Mansion\")) |> \n    # Location cleaning\n    mutate(location = ifelse(restaurant %in% \n                               c(\"Nizza Restaurant @ Sofitel Kuala Lumpur Damansara\",\n                                 \"Sri Nirwana Maju Restaurant - Bangsar\",\n                                 \"Hornbill Restaurant & Cafe\", \n                                 \"Malai Thai Cuisine @ Cormar Suites\",\n                                 \"Qureshi\",\n                                 \"Aliyaa Island Restaurant & Bar\",\n                                 \"Skillet KL\",\n                                 \"Geographer cafe Kuala Lumpur\",\n                                 \"Gastro Sentral, Le Méridien Kuala Lumpur\",\n                                 \"Horizon Grill @ Banyan Tree Kuala Lumpur\",\n                                 \"Chamber’s Grill\",\n                                 \"Mercat Barcelona Gastrobar (1MontKiara)\",\n                                 \"Chynna\", \n                                 \"The Grand Getaway\",\n                                 \"Dining in the Dark KL\",\n                                 \"Sausage KL Cafe & Deli\"), \n                             \"KL\", \n                             location)) |> \n    # Some cleaning \n    mutate(restaurant = str_replace(restaurant, \"Birch\", \"Huckleberry\")) |> \n    mutate(restaurant = str_replace_all(restaurant, \"Passage thru'\", \"Passage Thru\"),\n           restaurant = str_replace_all(restaurant, \n                                        \"Little Penang Cafe|Little Penang Kafe\",\n                                        \"Little Penang Kafé - KLCC\"),\n           restaurant = str_replace_all(restaurant, \"The Grand Getaway by Grand Hyatt Kuala Lumpur\", \n                                        \"The Grand Getaway\"), \n           restaurant = str_replace_all(restaurant, \"Gravybaby\", \"GravyBaby\"), \n           restaurant = str_replace_all(restaurant, \"Ploy\", \"PLOY\"), \n           restaurant = ifelse(restaurant == \"What Tasty Food\", \"WTF - What Tasty Food\", restaurant),\n           restaurant = ifelse(restaurant == \"ATAS\", \"ATAS at The RuMa Hotel & Residences\", restaurant), \n           restaurant = ifelse(restaurant == \"Al Rawsha Restaurant Kuala Lumpur\", \"Al Rawsha Restaurant\", restaurant), \n           restaurant = ifelse(restaurant == \"Aliyaa\", \"Aliyaa Island Restaurant & Bar\", restaurant), \n           restaurant = ifelse(restaurant == \"Arthur's Bar & Grill, Shangri-La Hotel, Kuala Lumpur\", \n                               \"Arthur's Bar & Grill\", restaurant), \n           restaurant = ifelse(str_detect(restaurant, \"Lemon Garden\"), \n                               \"Lemon Garden\", \n                               restaurant), \n           restaurant = ifelse(str_detect(restaurant, \"Din Tai Fung at The Gardens Mall\"),\n                               \"Din Tai Fung at The Gardens Mall\", \n                               restaurant), \n           restaurant = ifelse(restaurant == \"Monnalisa Italian Restaurant\", \n                               \"Monnalisa Ristorante Italiano\", \n                               restaurant), \n           restaurant = ifelse(str_detect(restaurant, \"Fatty Mee Hoon Kuih\"), \n                               \"Fatty Mee Hoon Kuih\", \n                               restaurant), \n           restaurant = ifelse(str_detect(restaurant, \"Whisky Bar KL\"), \n                               \"The Whisky Bar\", \n                               restaurant), \n           restaurant = str_replace_all(restaurant, \"W XYZ\", \"WXYZ\"), \n           restaurant = ifelse(restaurant == \"The Daily Grind Bangsar\", \n                               \"The Daily Grind\", \n                               restaurant), \n           restaurant = ifelse(restaurant == \"Chili's 1 Utama\", \"Chili's\", restaurant), \n           restaurant = str_replace_all(restaurant, \"Merini\", \"Marini\"))  |>\n    mutate(\n      cuisine = case_when(\n        \n        # The order of the case_when statements is important. Particularly, it should go\n        # South Asian -> Buffet -> Fusion,\n        # This is because I would consider South Asian buffet restaurants as South Asian.\n        # And I would not consider hotel buffets to be a type of fusion restaurant, \n        # despite all the types of food they might serve.\n        # Also, Grill before Bar.\n        \n          str_detect(\n          restaurant,\n          \"Grill|Steakhouse|Grub|Steak|Brasserie|steakhouse|BBQ|Rock Salt Restaurant|BBP|Churrascaria|Marble 8|Beast|Nando's|Nandos|Bar B Q|Down to Bones|Barbecue|Vantador|Bbq|Butcher Carey|PRIME|Brasserie|Karnivormalaya|Chamber's\"\n        ) ~ \"Grill\",\n          str_detect(restaurant,\n          \"Bistro|Deli|Secret Recipe|Tujo|Wild Sheep|Antipodean|Coffee|One Half|Blue Room|Awesome Canteen|Botanica|Chili's|Don's Diner|GravyBaby|Hornbill|Huck's|myBurgerLab|Naj & Belle|Tony Roma's|Louisiana|Cor Blimey|4Fingers|Bacon And Balls|POP PIZZA|After Black|Ashley's by Living Food|March Azalea Kitchen|Mighty Monster IPC|Sköhns Canteen|Table9|Rabbit Hole|Williams Corner|Tiki Taka|4 Fingers|Ben's|Souled Out|Suzi's Corner|Fuel Shack Signature|SOULed OUT|TGI Friday|Chilli's|Pigs & Wolf|Ship|Breakfast Thieves|Ante|Morganfield's|Subway|Meat The Porkers|Pan & Tamper|Hubba Mont Kiara|Bacon & Balls|Tate|Gin Ger|Fuel Shack|Jarrod & Rawlins|BreadFruits|Glass Tartines and Tipples|B-Lab|Mighty Monster|Ticklish Ribs|Cozy Corner|Duddha|Fat Brother|Define:food|Tangerine|Sausage & Ribs Shack|Texas Chicken|Coco Fika|Andra By Gula Cakery|D Place|Chef Zubir|Hubz|Maipi Corner|Marrybrown|Meet and Meat|Jibby & Co|Midwest|WhupWhup|Foodilicious Kitchen Shah Alam|Craveat\"\n        ) ~ \"Casual Western\",\n        str_detect(\n          restaurant,\n          \"Chinese|Taiwan|[\\\\p{Han}]|Nam Heong|Dynasty|Putien|Hoi|Gold Dragon|Han Room|Village Duck|Village Roast Duck|Unique|Steamboat|Ah |Roast Pork|Hokkien Mee|Dim Sum|Lai Po Heen|Yun House|Chynna|Li Yen|Shanghai|Lai Foong|Little Penang Kafé|Goon Wah|Shang Palace|YEN|Yut Kee|Din Tai Fung|Dragon-i|Celestial Court|The Ming Room|Sai Woo|Luk Yu|Yue|Way Modern Chinois|Hong Kong|Blue Boy Vegetarian Food Centre|Xin|Lai Ching Yuen|Noble House|Noodle House|Bak Kut|Fong Lye|Wan Tan Mee|Sarawak Laksa|Hakka|Ruyi & Lyn|Chicken rice|Chicken Rice|Char Siew|Siew Yoke|Dim Sum|Chiu Chow|Hainan|Hailam|Pork Noodles|Koong Woh Tong|Yong Tow Foo|Madam Tang| Kee|The Pot KL|Yu Noodle Cuisine|Wan Chun Ting|Muk Koot|Oversea|Marco Polo|Cu Cha Restaurant|Imperial|Grand Harbour|In Colonial Restaurant|Museum Restaurant|Heng|Hiong Kong|Ban Lee Restaurant|Heong|Restaurant Mama Love|Hee Lai Ton|New Paris|Kingdom Palace|Siu Siu|Sam You|Ti Chen|Mee Hoon|Fishball|Peoh|Esquire|Restourant Boston|7th Mile Kitchen\"\n        ) ~ \"Chinese\",\n        str_detect(\n          restaurant,\n          \"Italia|Olive|Ristorante|Osteria|Prego|Pizza|Trattoria|Nero Nero|Positano|a'Roma|Vin's Restaurant|Michelangelo|Marini's|Nizza|Porto Romano|Tatto|Neroteca|La Risata|Portofino|Ciao|Enoteca|Mangiare|Sassolino|Pizzeria|La Casa Restaurant & Patisserie|Favola|Senja Restaurant|Graze\"\n        ) ~ \"Italian\",\n        str_detect(\n          restaurant,\n          \"German|French|Chez|Marta's|Tapas|Bistro à Table|Iberico|El Toro Loco|Petit|Mercat|Dominic|El Cerdo|Quivo|Skillet KL|iberico|Yeast|Maison Francaise|El Mesón|Lafite|Topshelf|Wurst|Sabayon|Chateau|Naughty Babe Dirty Duck|Hit & Mrs|Le Gourmandin|Soleil|Suisse|IKEA|Leonardo|MARCO Creative Cuisine|Abanico|La Belle Saison\"\n        ) ~ \"European\",\n        str_detect(restaurant, \"Thai|Bangkok|BKK|Baan|Tamarind Springs|Chakri|BAAN|Samira by Asian Terrace|Ekkamai|Busaba|Mamasan|Krung Thep|Tomyam|Aroma Restaurant|Chef Korn|Tuk Tuk\"\n                   ) ~ \"Thai\",\n        str_detect(restaurant, \"Arab|Turkish|Al-|Halab|Egyptian|Tarbush|Wadi|Sahara Tent|Shawarma|Damascus|Syria|Hadramawt|diafah|Iraq|Sarifa|Al Rawsha|The Castle Restaurant|Saba Restaurant|Marhaba|ALRAWSHA Restaurant|Antara|Andalus|El Sham|Oregi Restaurant\"\n                   ) ~ \"Levantine\",\n        # Malay (Chef Wan) and Malaysian (Madan Kwan's)\n        str_detect(\n          restaurant,\n          \"Malay|Rasa|Cik|Dapur|Rebung|Zakhir|Village Park|ADU|Warisan|Nasi|Dancing Fish|Sarang|Bijan|Serai|Sambal|ATAS|Grandmama's|Onde Onde|JP teres|Satay Station|Chef Wan|De.Wan|Siti Li Dining|Pintu|Ramly|Penyet|Sepiring|Satay|Restoran Ali Food Corner|Open House|Sup Utara|Bawal Power|Ikan|Gulai|Kampung Mu|Marlina Station|Wong Solo|Bawang|Goreng\"\n        ) ~ \"Malay\",\n        str_detect(\n          restaurant,\n          \"Nonya|Baba|Mum's Place|Madam Kwan|Chuup|Old China Cafe|Nyonya|Little Penang|Oriental Cravings|Papparich|Uncle Don|Muar Restaurant|Kumi|Peranakan|1919 Restaurant|Penang\"\n        ) ~ \"Malaysian\",\n        str_detect(\n          restaurant,\n          \"Japan|Edo|Sushi|Kampachi|Iketeru|Menya|Nobu|Omakase|TOKYO|Tokyo|Tonkatsu|Udon|Soba|Ichibanya|Maruhi|Omulab|Zipangu|Miyabi|Izakaya Hanazen|hokkaido|Senya|IPPUDO|Umai-Ya|Ichiban|Yakiniku|Nihon|Lucky Tora|Hokkaido|Mo-Mo Paradise|Sushi|sushi|Uokatsu|Ramen|Tempura|Izakaya|Tokyo|Kyoto|Oishii|Gyoza|Ichiban|Tonkotsu|Tonkatsu|Sakura|Yakitori|Kyush|Teppanyaki|Taka|Kikubari|Ichiyutei|Enju|Okonomi|Toridoki|Syokudo|Tsukiji|Yuzu|Madam Salma|Fu-Rin\"\n        ) ~ \"Japanese\",\n        # Why not merge all Korean BBQ into grill?\n        str_detect(\n          restaurant,\n          \"Filipino|Bali|Vietnam|GOODDAM|Korea|Sao Nam|Naughty Nuri's|KyoChon|Viet|Dakgalbi|Sopoong|Kung Jung|Saigon|Sae Ma Eul|KoRyo-Won|Koryowon|Persia|Astana|Buns & Noodles|Kyochon|Topokki\"\n        ) ~ \"Other Asian\",\n        \n        # Do not str_detect(.x, \"bar\")\n        str_detect(restaurant, \"Whisky|Lounge|Bar|Decanter|Knowhere Bangsar|The Locker & Loft|Tom, Dick & Harry's|WET|The Enclave|Out of Africa|Opium|THIRTY8|Healy Mac's|TEMPTationS|Loco bar|La Bodega|Vertigo|The Social|No Black Tie|The BAR|O'Galito|Table 23|D Legends bar|Bobo KL|Rock Bottom|twenty-one kitchen+bar|Bentley's Pub|Vinh City Entertainment|twenty-one|Malones|White Horse Tavern|Supperclub KL|Backyard|The Ceylon bar|W1 Dining & Cocktails|Splash|Drop Exchange|Boardwalk|Deep Blue|The Sticky Wicket|OneSixFive|The Attic|Concubine KL|The Green Man|THE BAR|Marini’s on 57|Rooftop 25\"\n        ) ~ \"Bar\",\n        str_detect(restaurant, \"Cafe|Grind|Café|Tujo|cafe|Alexis|The Loaf|Yellow Brick Road|Huckleberry|TWG|Newens Tea House|Miss Ellie Tea House|Frisky Goat|Urbean|Ra-Ft|Backofen|STG Bukit Ceylon|VCR|Rise & Shine by Tapestry|Kafe|Kaffe|Kopi|Latte|Kopitiam\"\n        ) ~ \"Cafe\",\n        str_detect(\n          restaurant,\n          \"Kerala|India|Lanka|Malabar|Curry|Raju|Bhavan|Thosai|Tandoor|Bombay|Gem Restaurant|Nasi Kandar|NADODI|Qureshi|RSMY|Sangeetha|Nirwana|Asian Rice Pot|Masala|Annalakshmi|Aliyaa|MTR|Devi's Corner|WTF - What Tasty Food|Nadodi|Delhi Royale|FLOUR|Bakti Woodlands|Vishal Food|Banana Leaf|Hyderabad|sarvana bhavan|Spice Garden|Roti|TasteBud|Chapati|Pakistani|Jai Hind|BananaBro|Naan|SK Corner|Sri Paandi|Majapahit|Nan |GinRikSha|Briyani|Biryani|Maju Palace|Seetharam|Havelly|Punjab|Goa By Sapna Anand|Swaadisht|Mamak|Sri|Chapathi|Moghul|Rani|Aryan|Yarl|Sagar|ABC Foods Corner|Sheesh Mahal|Mallikas\"\n        ) ~ \"South Asian\",\n        \n        # Buffet list\n        restaurant %in% trip_buffet_list ~ \"Buffet\",\n        restaurant %in% google_buffet_list ~ \"Buffet\", \n        str_detect(restaurant, \"Flock, W Kuala Lumpur|HYdeout By Grand Hyatt Kuala Lumpur|Curate\"\n                   ) ~ \"Buffet\", \n        # List of fusion restaurants\n        restaurant %in% trip_fusion_list ~ \"Fusion\",\n        restaurant %in% google_fusion_list ~ \"Fusion\", \n        str_detect(restaurant, \"Symphony by Chef Jo|Darren Chin|Dewakan|DC Restaurant|Sitka|Ginger Restaurant|Table & Apron|Foodsbury\"\n                   ) ~ \"Fusion\", \n        \n        # Unfortunate, there aren't enough Latino restaurants for their own category\n        str_detect(restaurant, \"Latino|Mexican|Carretas|Mexico|Frontera|Mexicana|Cocina\"\n        ) ~ \"Other\",\n        str_detect(restaurant, \"Oliver Gourmet|Seafood|Shell Out|BAIT|Fisherman|Fish & Co|Shucked|Delay No More Crab Restaurant|Ombak\"\n        ) ~ \"Seafood\",\n        str_detect(restaurant, \"Vasco's|Latest Recipe|Lemon Garden|Prime|Gastro Sentral|Chinoz On The Park|Shook|Plane In The City|Contango|The Living Room|Curate At Four Seasons|Beta KL|CEDAR on 15|The Apartment|The Grand Getaway|Strato|Ril's|Chocha|Wizards at Tribeca|Nipah|Joloko|Leonardo's Dining Room & Wine Loft|Roofino Skydining|Troika|Dining In The Dark KL|PLOY|Atlas Gourmet Market|WIP|Nathalie Gourmet Studio|Altitude|The Canteen by Chef Adu|Latitude 03|The Orchid Conservatory|Graze Restaurant|Zende Restaurant|Crystal|Cielo KL|Cedar On 15\"\n        ) ~ \"Other Upmarket\",\n        # Just mopping up all the Dai Chow\n        # I feel this is going to create problems down the line\n        str_detect(restaurant, \"Restoran\"\n        ) ~ \"Chinese\",\n        TRUE ~ \"Other\"\n  )) |> \n    mutate(rowid = row_number())\n}\n\n\n```\n\n\n```{r trip-kl-cuisine and google-kl-cuisine}\ntrip_kl_cuisine <- trip_reviews |> \n  filter(location %in% c(\"KL\", \"Petaling Jaya\", \"Shah Alam\")) |> \n  reviews_cuisine_cleaning() \n\ngoogle_kl_cuisine <- google_reviews |> \n  filter(location %in% c(\"KL\", \"Petaling Jaya\", \"Shah Alam\")) |> \n  reviews_cuisine_cleaning()\n\ntrip_kl_cuisine |> write_csv(\"./data/trip_kl_cuisine.csv\")\n\ngoogle_kl_cuisine |> write_csv(\"./data/google_kl_cuisine.csv\")\n\nsummary_stats <- rbind(\ntrip_kl_cuisine |>\n  mutate(count = 1) |> \n  group_by(restaurant) |> \n  mutate(reviews = sum(count)) |> \n  ungroup() |> \n  filter(reviews >= 20) |> \n  summarise(mean_rating = mean(rating), \n            median_rating = median(rating), \n            mode_rating = Mode(rating)) |> \n  mutate(source = \"Trip Advisor\"),\n\ngoogle_kl_cuisine |>\n  mutate(count = 1) |> \n  group_by(restaurant) |> \n  mutate(reviews = sum(count)) |> \n  ungroup() |> \n  filter(reviews >= 20) |> \n  summarise(mean_rating = mean(rating), \n            median_rating = median(rating),\n            mode_rating = Mode(rating)) |> \n  mutate(source = \"Google\")\n)\n```\n\n<br><br><br>\n\n## Comparisons of average ratings\n\nWith reference to the histograms below, that ratings are skewed towards the higher end: the mean rating of restaurants on Google is **`r summary_stats |> filter(source == \"Google\") |> pull(mean_rating) |> round(2)`** and the mean rating on Trip Advisor is **`r summary_stats |> filter(source == \"Trip Advisor\") |> pull(mean_rating) |> round(2)`**. The median and mode for both datasets is **5**.  \n\nIt really could be said that the default review rating is five stars. This means that restaurant reviews on these platforms are quite lenient. It is hard for me to believe that half of all reviews were about truly exceptional dining experiences: **`r round(google_kl_cuisine |> filter(rating == 5) |> nrow() / nrow(google_kl_cuisine) * 100, 2)`%** of all ratings in the Google dataset for the Klang Valley (KL, PJ and Shah Alam in the datasets) are five stars; in Trip Advisor, it was **`r round(trip_kl_cuisine |> filter(rating == 5) |> nrow() / nrow(trip_kl_cuisine) * 100, 2)`%**. \n\n<br>\n\n```{r compare-mean-ratings-histogram}\ncompare_histograms <- function(tbl){\n  tbl |> \n    mutate(count = 1) |> \n    ggplot(aes(x = rating, y = count)) + \n    geom_col(fill = \"#6a994e\") + \n    scale_y_continuous(labels = comma) + \n    labs(y = \"Number of reviews\", \n         x = \"Rating/Stars\")\n}\n\ngoogle_kl_cuisine |> \n  compare_histograms() +\n  labs(title = \"Google ratings\") +\n  coord_flip() +\n\ntrip_kl_cuisine |> \n  compare_histograms() +\n  labs(title = \"TripAdvisor ratings\") + \n  coord_flip() +\n  \n  plot_annotation(\n    title = \"Similar distributions of review ratings in Google and Trip Advisor\",\n    subtitle = \"Only includes restaurants in the Klang Valley.\"\n  )\n\nggsave(\"./plots/ratings_summary.png\", height = 4, width = 7, units = \"in\")\n```\n\n<br>\n\nReviews are limited (in every sense of the word) to a one-to-five scale. In the scatterplots below, we note that **almost all restaurants mostly receive five stars (blue) or four stars (green)**. This does seem to indicate that restaurant ratings are not very good at distinguishing between restaurants. \n\n\n<br>\n\n\n```{r restaurant-comparison-trip-google, warning=FALSE, message=FALSE}\n\ncompare_google_trip <- function(tbl){\n  \n  tbl |> \n    group_by(restaurant, cuisine) |> \n    summarise(reviews = n(), \n              mean_rating = mean(rating), \n              median_rating = median(rating), \n              mode_rating = Mode(rating),\n              .groups = \"drop\") |>  \n    filter(reviews >= 20)\n  }\n\nplot_google_trip <- function(tbl){\n  \n  tbl |> \n    ggplot(aes(x = reviews, \n               y = mean_rating)) +\n    geom_point(aes(colour = median_rating), \n               alpha = .4) + \n    # scale_size_continuous(limits = c(1, 10)) +\n    scale_x_log10(labels = comma) +\n    scale_colour_viridis(option = \"turbo\", begin = .15, end = .9, direction = -1, \n                         labels = label_number(accuracy = .1)) +\n    # ggrepel::geom_text_repel(aes(label = cuisine)) + \n    geom_smooth(method = \"lm\", alpha = .1, size = 0, span = .5) + \n    geom_smooth(method = \"lm\", se = FALSE, alpha = .1, size = .2) + \n    labs(subtitle = \"Restaurants with less than 20 reviews excluded\", \n         x = \"Number of reviews\",\n         y = \"Mean Rating\",\n         colour = \"Median Rating\") +\n    theme(legend.title = element_text(size = 9), \n          legend.text = element_text(size = 7),\n          legend.key.size = unit(0.9, \"lines\"))\n    \n}\n  \n\ngoogle_kl_cuisine |> \n  compare_google_trip() |> \n  plot_google_trip() + \n  # ylim(3.8, 4.6) +\n  labs(title = \"Google reviews\") +\n  guides(size = guide_legend(override.aes = list(alpha = 1))) +\n\ntrip_kl_cuisine |> \n  compare_google_trip() |> \n  plot_google_trip() + \n  # ylim(3.8, 4.6) +\n  labs(title = \"Trip Advisor reviews\") +\n  guides(size = \"none\") +\n  \n  plot_annotation(title = \"Klang Valley restaurants and average ratings\") +\n  plot_layout(guides = \"collect\") & theme(legend.position = \"bottom\")\n\nggsave(\"./plots/cuisine_comparison_trip_google.png\", height = 7, width = 11, units = \"in\")\n\n```\n\n<br><br><br>\n\n\n## Adding cuisine\n\nThese are the columns present in the Google dataset: \n\n```{r}\ngoogle_reviews |> \n  colnames() \n\n```\n\nTrip Advisor has additional columns for `review title` and `date`. \n\nLet's add a column for cuisine (the code can be downloaded at the top of the page, but it was a lot of manual work) to increase interpretability and to maximise the usefulness of the data. We'll narrow down the scope to locations in the Klang Valley (KL, PJ and Shah Alam, in the datasets; since I'm most familiar with and most interested in this metro).  \n\nDetermining the cuisine of a restaurant was mostly fairly obvious, and the categories hopefully self-explanatory. Additional notes on the coding of these cuisines may be found in the appendices. \n\nLet's start first with an overview of both datasets, now with cuisines included. From the plot below, we see that: \n\n* South Asian, Chinese, Casual Western, Japanese and Bars are the most commonly-reviewed restaurants in the Klang Valley. These are not the most common nor the most commonly-visited restaurants (hawker stalls).  \n\n* Chinese, Casual Western, Malaysian and Thai are the lowest-rated cuisines. \n\n* Fusion, Other Upmarket (experiential dining or unspecified \"international\" cuisine) and bars have the highest ratings, with 60% or more of all reviews being five stars. \n\n* Trip Advisor and Google reviewers differ the most on their opinions of Levantine, Casual Western and Japanese restaurants. With regards to Levantine food, in my opinion at least, it might be a case of \"good for Malaysia\", but not necessarily good compared to outside of it. \n\n* The x-axes on the plots below show the percentage of reviews that are five stars by cuisine. This actually provides much more differentiation than just the mean rating (which is reflected in the colours below).  \n\n\n<br>\n\n\n```{r cuisine-comparison-barchart, fig.width=7}\n\ngoogle_kl_cuisine |> \n  mutate(count = 1) |> \n  group_by(cuisine) |> \n  summarise(reviews = n(), \n            five_star_reviews = sum(count[rating == 5]), \n            mean_rating = mean(rating)) |> \n  mutate(five_star_pc = five_star_reviews / reviews, \n         source = \"Google\")|> \n  select(five_star_pc, cuisine, source, reviews, mean_rating) |> \n  rbind(\n    trip_kl_cuisine |> \n      mutate(count = 1) |> \n      group_by(cuisine) |> \n      summarise(reviews = n(), \n                five_star_reviews = sum(count[rating == 5]), \n                mean_rating = mean(rating)) |> \n      mutate(five_star_pc = five_star_reviews / reviews, \n             source = \"Trip Advisor\") |> \n      select(cuisine, five_star_pc, source, reviews, mean_rating)\n  ) |> \n  ggplot(aes(x = five_star_pc, \n             y = fct_reorder(cuisine, mean_rating), \n             fill = mean_rating)) + \n  geom_col(alpha = .7) + \n  scale_x_continuous(labels = percent) +\n  geom_text(aes(label = comma(reviews)), \n            position = position_dodge(width = .9), \n            hjust = \"inward\", \n            colour = \"grey20\") + \n  scale_fill_viridis(direction = -1, begin = .2) +\n  facet_wrap(~ source) + \n  theme(strip.background = element_rect(fill = \"black\"), \n        strip.text = element_text(face = \"bold\"),\n        legend.title = element_text(size = 9), \n          legend.text = element_text(size = 7),\n          legend.key.size = unit(0.9, \"lines\")) +\n  labs(x = \"% of reviews that are five-stars\", \n       y = \"\", \n       title = \"% of reviews that are five stars on Google and Trip Advisor, by cuisine\", \n       subtitle = \"Only restaurants in the Klang Valley. Total number of reviews at the end of each bar.\", \n       fill = \"Mean\\nrating\")\n  \n\n```\n\n<br><br><br>\n\n\n\n## Restaurants in both Google and Trip\n\nLet's investigate a bit more by looking at restaurants that appear in both the Google and Trip datasets. \n\nBelow, we have plotted restaurants based on their mean ratings on Google and Trip Advisor. The globalised nature (with such heavy representation from casual western restaurants) of the Malaysian food scene seems to result in Google (which is used more heavily by locals) and Trip Advisor (which is used more often by travellers) agreeing more than not. \n\nLooking at the top-right quadrant, we see that the restaurants rated most highly by Google and Trip Advisor are mostly fine dining: Sushi Hibiki is a high-end omakase restaurant and seems to be regarded as the best meal in the Klang Valley; DC Restaurant has one Michelin star. Sausage Kl Cafe and Grill, however, was a restaurant specialising in full English breakfast. And Antipodean is a cafe that is, to me, a solid 3.5/5; but it still has around the same Trip Advisor rating as Dewakan, which has two Michelin stars. \n\nWe'll look into this more in next week's section of the report, but it appears that the commonality of five-star reviews indicates that the mean rating might be more an indicator of expectations being met, than any true excellence. \n\n\n<br>\n\n```{r restaurant-fuzzy-match, warning=FALSE}\n\nrestaurant_fuzzy_match <- stringdist_join(\n  trip_reviews |> \n    filter(location %in% c(\"KL\", \"Petaling Jaya\", \"Shah Alam\")) |> \n    distinct(restaurant) |> \n    mutate(restaurant_match = str_remove_all(restaurant, \"Restaurant|Cuisine|restaurant|Restoran|Curry House|Japanese\"), \n           restaurant_match = trimws(restaurant_match)) |> \n    select(restaurant_trip = restaurant, \n           restaurant_match), \n  google_kl_cuisine |> filter(location %in% c(\"KL\", \"Petaling Jaya\", \"Shah Alam\")) |> \n    distinct(restaurant)|> \n    mutate(restaurant_match = str_remove_all(restaurant, \"Restaurant|Cuisine|restaurant|Restoran|Curry House|Japanese\"),\n           restaurant_match = trimws(restaurant_match)) |> \n    select(restaurant_google = restaurant, \n           restaurant_match), \n  by = \"restaurant_match\", \n  ignore_case = TRUE, \n  method = \"jw\",\n  max_dist = 99, \n  distance_col = \"dist\"\n) |> \n  group_by(restaurant_match.x) |> \n  slice_min(order_by = dist, n = 1) |> \n  arrange((dist)) |> \n  select(match_x = restaurant_match.x, \n         match_y = restaurant_match.y, \n         dist,\n         restaurant_google, \n         restaurant_trip) |>\n  ungroup()\n\nboth_google_and_trip <- restaurant_fuzzy_match |> \n  filter(match_x != \"Teh Laris Cafe\" | match_y != \"Thosai Cafe\") |> \n  filter(match_x != \"The Ming Room\" | match_y != \"The Living Room\") |>\n  filter(match_x != \"Cilantro & Wine Bar\" | match_y != \"ZENZERO & Wine Bar\") |> \n  filter(match_x != \"Kedai Kopi Pak Ngah\" | match_y != \"Kedai Kopi Lai Foong\") |> \n  filter(match_x != \"Shanghai\" | match_y != \"Old Shanghai\") |> \n  filter(match_x != \"Ah Ni Bak Kut Teh\" | match_y != \"Ah Sang Bak Kut Teh\") |> \n  filter(match_x != \"Pin Wei Seafood\" | match_y != \"Hoi Peng Seafood\") |> \n  filter(match_x != \"Cafe Cafe\" | match_y != \"Cafe ETC\") |> \n  filter(match_x != \"Tao Chinese\" | match_y != \"Ee Chinese\") |>\n  filter(match_x != \"Seoul Garden\" | match_y != \"Lemon Garden\") |>\n  filter(match_x != \"De.Wan\" | match_y != \"Dewakan\") |>\n  filter(dist <= 0.16666667)\n\ncombined_google_trip <- trip_kl_cuisine |> \n  filter(restaurant %in% both_google_and_trip$restaurant_trip) |> \n  select(cuisine, location, restaurant, rating, review) |>\n  mutate(source = \"TripAdvisor\") |> \n  rbind(\n    google_kl_cuisine |> \n      filter(restaurant %in% both_google_and_trip$restaurant_google) |> \n      select(cuisine, location, restaurant, rating, review) |> \n      mutate(source = \"Google\")\n  ) |> \n  mutate(row_id = row_number()) |> \n  left_join(\n    both_google_and_trip |> \n      distinct(restaurant_google, restaurant_trip) |>\n      rename(restaurant = restaurant_trip),\n    by = c(\"restaurant\")\n  ) |> \n  left_join(\n    both_google_and_trip |> \n      distinct(restaurant_google, restaurant_trip) |>\n      rename(restaurant = restaurant_google),\n    by = c(\"restaurant\")\n  ) |> \n  mutate(restaurant_new = ifelse(!is.na(restaurant_google), \n                                 restaurant_google, \n                                 restaurant)) |> \n  group_by(row_id, location, cuisine, restaurant = restaurant_new, review, source) |> \n  summarise(rating = mean(rating), \n            .groups = \"drop\") |> \n  mutate(restaurant = trimws(restaurant))\n\n```\n\n\n\n```{r common-restaurants, fig.height=8, fig.width=10, eval=FALSE}\n\n# Putting in the finished plot, instead of evaluating again\n# so that I can embed a link to the full-size plot in the image\n\ncombined_google_trip |> \n  group_by(restaurant, source) |> \n  summarise(rating = mean(rating), \n          .groups = \"drop\") |> \n  pivot_wider(names_from = source, \n              values_from = rating) |> \n  left_join(\n    combined_google_trip |> \n      count(restaurant, \n            name = \"count\"), \n    by = \"restaurant\"\n  ) |> \n  left_join(\n    combined_google_trip |> \n      distinct(restaurant, cuisine), \n    by = \"restaurant\"\n  ) |> \n  filter(!is.na(Google) & !is.na(TripAdvisor)) |> \n  ggplot(aes(x = Google, y = TripAdvisor)) + \n  geom_smooth(alpha = .1, size = 0, span = .5, \n              method = \"lm\") + \n  stat_smooth(geom = \"line\", alpha = .1, size =.5, span = .5, \n              method = \"lm\") +\n  geom_point(aes(colour = cuisine, \n                 size = count)) + \n  scale_colour_viridis_d(option = \"turbo\") +\n  ggrepel::geom_text_repel(aes(label = restaurant), \n                           size = 1.2) + \n  labs(title = \"Comparison between Google and TripAdvisor restaurant ratings\", \n       subtitle = \"Size indicates number of reviews\", \n       y = \"Trip Advisor mean rating\", \n       x = \"Google mean rating\", \n       colour = \"Cuisine\", \n       size = \"Review count\") + \n  # guides(colour = guide_legend(override.aes = list(size = .7))) +\n  theme(legend.title = element_text(size = 6), \n        legend.text = element_text(size = 6), \n        legend.key.size = unit(0.3, \"lines\"))\n\nggsave(\"./plots/restaurant_comparison_trip_google.png\", height = 9, width = 11, units = \"in\")  \n```\n\n[![Click image for full size](./plots/restaurant_comparison_trip_google.png)](https://github.com/AIMdata-org/google_trip_reviews_kl_site/raw/main/plots/restaurant_comparison_trip_google.png)\n\n<br>\n\nWhat becomes clearer when we re-plot the restaurants, this time using percentage of ratings that are five stars, the distinction between fine dining and more casual restaurants is much clearer. Fine dining restaurants tend to have above 50% of their reviews being five stars in both Trip and Google.  \n\nThe restaurants in the \"fine dining\" group have higher floors and ceilings, when it comes to the percentage of ratings that are five stars. This is why lacking price range in this dataset is such a shame, as it seems like these two groups should be graded on their own curves.\n\nWe also see how Google reviewers are stricter (less lenient), with restaurants struggling to get above 70% five-star reviews. Though, as mentioned this isn't any particular mark of quality. \n\nAlso to be investigated further is to what extent restaurants in the \"fine dining\" achieve their higher scores due to better service and environments, as opposed to food quality. \n\n\n<br>\n\n```{r new-rating-common-restaurants, fig.height=8, fig.width=10, warning=FALSE, eval=FALSE}\n\n# Putting in the finished plot, instead of evaluating again\n# so that I can embed a link to the full-size plot in the image\n\ncombined_google_trip |> \n  mutate(new_rating = ifelse(rating %in% c(5), 1, 0)) |> \n  group_by(restaurant, source) |> \n  summarise(new_rating = mean(new_rating), \n            .groups = \"drop\") |> \n  pivot_wider(names_from = \"source\", \n              values_from = new_rating) |> \n  left_join(\n    combined_google_trip |> \n      count(restaurant, \n            name = \"count\"), \n    by = \"restaurant\"\n  ) |> \n  left_join(\n    combined_google_trip |> \n      distinct(restaurant, cuisine), \n    by = \"restaurant\"\n  ) |> \n  filter(!is.na(Google) & !is.na(TripAdvisor)) |> \n  ggplot(aes(x = Google, y = TripAdvisor)) + \n  geom_smooth(alpha = .1, size = 0, span = .5) + \n  stat_smooth(geom = \"line\", alpha = .1, size =.5, span = .5) +\n  geom_point(aes(colour = cuisine, \n                 size = count)) + \n  scale_colour_viridis_d(option = \"turbo\") +\n  ggrepel::geom_text_repel(aes(label = restaurant), \n                           size = 1.2) + \n  scale_x_continuous(labels = percent, breaks = c(0, 0.2, 0.3, 0.4, 0.5, \n                                                  0.6, 0.7, 0.8, 0.9, 1), \n                     limits = c(0.2, .87)) + \n  scale_y_continuous(labels = percent, breaks = c(0, 0.2, 0.3, 0.4, 0.5, \n                                                  0.6, 0.7, 0.8, 0.9, 1), \n                     limits = c(0.2, .94)) +\n  scale_size_continuous(breaks = c(100, 500, 1000, 2000)) +\n  labs(title = \"Comparison between Google and TripAdvisor using percentage of 5-star reviews\", \n       subtitle = \"Size indicates number of reviews.\", \n       y = \"% of 5-star ratings, Trip Advisor\", \n       x = \"% of 5-star ratings, Google\",\n       caption = \"Sources: Google; TripAdvisor; Ng Choon Khon.\",\n       colour = \"Cuisine\", \n       size = \"Review count\") + \n  # guides(colour = guide_legend(override.aes = list(size = .7))) +\n  theme(legend.title = element_text(size = 6), \n        legend.text = element_text(size = 6), \n        legend.key.size = unit(0.3, \"lines\"))\n\nggsave(\"./plots/restaurant_comparison_new_ratings2.png\", height = 9, width = 11, units = \"in\")  \n```\n\n[![Click image for full size](./plots/restaurant_comparison_new_ratings2.png)](https://github.com/AIMdata-org/google_trip_reviews_kl_site/raw/main/plots/restaurant_comparison_new_ratings2.png)\n\n<br><br><br>\n\n## Conclusions: Part one\n\nLet's review what we've learnt so far; though we probably already knew some of these things instinctually, it is still nice to get confirmation: \n\n* Reviews skew very heavily towards five stars. More than half of all reviews give five stars. This means that Google Maps and TripAdvisor are not useful in determining where one should eat since five stars could mean anything from \"met expectations\" to \"truly exceptional\". \n\n* Re-sorting (lowest, most recent) and filtering reviews will likely provide more informative reviews on Google. There is no real reason to accept their default sorting by \"relevance\" as you can pay for visibility, pay for reviews, and pay to remove reviews.\n\n* However, this means that we're still engaging with reviews as individual data points. Even looking at the review summary will not always be helpful, since having five-star reviews be less than 50% of your total is more an indicator that the restaurant is not fine dining, than any other indicator of quality. \n* Outside of the home, hawker centres and coffee shops are places where food is most commonly consumed. Yet these businesses are not reviewed with anywhere the same frequency as the casual western eateries or chinese restaurants/*dai chows*. It is difficult (by design?) to mark individual hawkers since they operate from within the premises of another business. Additionally, hawkers are much less likely to engage with Google or Trip Advisor to curate or market their online presence, leading to these platforms being blind to the needs of hawkers and continue to cater towards restaurants (who might actual have marketing budgets).\n\nRare is the occasion that I, whilst searching on Google or Trip Advisor, find a truly exceptional meal. My most memorable experiences have mostly been the result of personal recommendations or curated lists from trusted reviewers. I'm starting to think that the main purpose of review platforms is marketing. \n\n<br><br><br>\n\n## Appendices\n\n### Notes on cuisine\n\nWith reference to the cleaning script for determining the cuisine of a restaurant, there are few things to bear in mind in trying to update or improve it. \n\nI have made a distinction between Malay and Malaysian cuisines. This difference can be boiled down to Chef Wan (Malay) vs. Madan Kwan (Malaysian). A Hainan Kopitiam would be considered as Malaysian. \n\nA few more points for the ordering of arguments within the `case_when` statement: \n\n\"Other Upmarket\" is mostly expensive experiential dining, with some tourist traps. In this category are *Dining in the Dark* and *Plane in KL*. I've also included Turkish food under the \"Levantine\" umbrella.\n\n\"Fusion\" restaurants are explicitly fusion restaurants, with the word \"fusion\" in their names or showing up in a proportion of reviews. The same is true for buffet restaurants (which were numerous enough in the Trip Advisor dataset to warrant their own category). \n\nI have considered South Asian buffet restaurants to be South Asian restaurants. I And I do not consider hotel buffets to be a type of fusion restaurant, despite all the types of food they might serve. Additionally, when altering the cleaning script, make sure that the argument for grills is before that for bars (because of \"barbecue\"). \n\nThe Google and Trip Advisor datasets for the Klang Valley have a fairly comparable number of reviews: `r google_kl_cuisine |> nrow() |> format(big.mark = \",\")` in Google and `r trip_kl_cuisine |> nrow() |> format(big.mark = \",\")` in Trip Advisor. \n\n<br>\n\n```{r reviews-by-cuisine, fig.height=6.5}\ncuisine_intermediate <- trip_kl_cuisine |> \n  count(cuisine, sort = TRUE, name = \"trip_reviews\") |> \n  left_join(\n    google_kl_cuisine |> \n      count(cuisine, sort = TRUE, name = \"google_reviews\")\n  ) |> \n  mutate(\n    total_reviews = trip_reviews + google_reviews\n  ) |> \n  arrange(desc(total_reviews)) \n\ncuisine_intermediate |> \n  pivot_longer(cols = c(trip_reviews, google_reviews, total_reviews), \n               names_to = \"source\", \n               values_to = \"count\") |> \n  mutate(source = str_replace_all(source, \"_reviews\", \"\"), \n         source = str_to_title(source),\n         source = str_replace_all(source, \"Trip\", \"Trip Advisor\")) |> \n  mutate(source = factor(source, levels = c(\"Google\",\n                                            \"Trip Advisor\",\n                                            \"Total\"))) |> \n  ggplot(aes(x = count, y = fct_rev(fct_relevel(cuisine, cuisine_intermediate |> pull(cuisine))))) + \n  geom_col(aes(fill = cuisine)) +\n  geom_text(aes(label = comma(count)), \n            position = position_dodge(width = .9), \n            hjust = \"inward\", \n            colour = \"grey20\", \n            size = 3) +\n  facet_wrap(~source, scales = \"free_x\") + \n  scale_x_continuous(labels = number_format(scale = 1/1000, suffix = \"k\", \n                                            accuracy = 1)) + \n  scale_fill_viridis_d(option = \"turbo\") + \n  theme(legend.title = element_text(size = 8), \n        legend.text = element_text(size = 8), \n        legend.key.size = unit(0.3, \"lines\"), \n        strip.background = element_rect(fill = \"black\"), \n        plot.caption = element_text(hjust = .5)) + \n  labs(x = \"Number of reviews\", \n       y = \"\", \n       fill = \"Cuisine\",\n       title = \"Number of reviews by cuisine\", \n       subtitle = \"Restaurants in the Klang Valley\", \n       caption = \"Sources: Ng Choon Khon; Google; TripAdvisor.\")\n\n  \n```\nTrip Advisor reviewers tended to review far more bars, buffets (including hotel buffets), cafes, fusion, Japanese and unspecified upmarket restaurants than Google reviewers. This is commonsensical since Trip Advisor tends to have travellers using it.\n\n<br><br><br>\n\n### Reference tables\n\nBelow are reference tables for the restaurants used in this analysis. \n\n#### Google: restaurants in the Klang Valley\n\nSorted in descending order, according to mean rating. \n\n```{r dt-google}\ngoogle_kl_cuisine |> \n  select(restaurant, cuisine, rating, location) |> \n  group_by(restaurant, cuisine, location) |> \n  summarise(mean_rating = round(mean(rating), 2),\n            median_rating = median(rating), \n            reviews = n(), .groups = \"drop\") |> \n  filter(reviews >= 20) |> \n  relocate(location, .after = reviews) |> \n  rename(`mean rating` = mean_rating, \n         `median rating` = median_rating) |> \n  arrange(desc(`mean rating`)) |> \n  datatable(filter = list(position = \"top\", clear = \"FALSE\"), \n            options = list(pageLength = 10, scrollX = TRUE), \n            caption = htmltools::tags$caption(\n              style = \n              \"caption-side: top;\n              text-align: center;\n              color: black;\n              font-size: 120% ;\",\n              \"Google: restaurants in the Klang Valley with more than 20 reviews\"\n            )) |> \n  formatStyle(0, target = \"row\", lineHeight = \"85%\", fontSize = \"80%\")\n\n\n```\n\n\n\n<br><br><br>\n\n#### Trip Advisor: restaurants in the Klang Valley\n\nSorted in descending order, according to mean rating. \n\n```{r dt-trip}\ntrip_kl_cuisine |> \n  select(restaurant, cuisine, rating, location) |> \n  group_by(restaurant, cuisine, location) |> \n  summarise(mean_rating = round(mean(rating), 2),\n            median_rating = median(rating), \n            reviews = n(), .groups = \"drop\") |> \n  filter(reviews >= 20) |> \n  relocate(location, .after = reviews) |> \n  rename(`mean rating` = mean_rating, \n         `median rating` = median_rating) |> \n  arrange(desc(`mean rating`)) |> \n  datatable(filter = list(position = \"top\", clear = \"FALSE\"), \n            options = list(pageLength = 10, scrollX = TRUE), \n            caption = htmltools::tags$caption(\n              style = \n              \"caption-side: top;\n              text-align: center;\n              color: black;\n              font-size: 110% ;\",\n              \"Trip Advisor: restaurants in the Klang Valley with more than 20 reviews\"\n            )) |> \n  formatStyle(0, target = \"row\", lineHeight = \"85%\", fontSize = \"80%\")\n\n\n\n\n```\n\n\n\n\n\n\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":false,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":true,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":true,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"toc-depth":4,"embed-resources":true,"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.6.42","editor":"source","brand":"brand/_brand.yml","theme":["cosmo","brand"],"toc-location":"left","toc-expand":true,"code-summary":"Show code","page-layout":"full","title":"How useful are restaurant reviews? Google and Trip Advisor reviews in the Klang Valley, Malaysia","subtitle":"Part one","author":"Sean Ng","organization":"AIMdata","date-modified":"26 December 2025"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}