filter(cuisine == "Casual Western" & rating == 5) |>
unnest_tokens(word, review) |>
anti_join(stop_words) |>
filter(str_detect(word, "[a-z]")) |>
add_count(word) |>
filter(n > 20) |>
pairwise_count(word, review_id, sort = TRUE),
by = c("item1", "item2")
) |>
igraph::graph_from_data_frame() |>
ggraph(layout = "fr") +
geom_edge_link(aes(alpha = correlation, edge_width = n), colour = "#457b9d", check_overlap = TRUE) +
scale_edge_width_continuous(range = c(.1, 4), trans = "log10") +
scale_alpha_continuous(range = c(0.01, 0.08)) +
geom_node_point(colour = "#457b9d", alpha = 0.2, size = .5) +
geom_node_text(aes(label = ifelse(name %in%
c("friendly", "ribs", "steak",
"sausage", "highly", "beer"),
name,
"")),
size = 3.1,
alpha = .9,
colour = "#00afb9",
fontface = "bold") +
geom_node_text(aes(label = name), size = 3.1, alpha = .4,
colour = "#caf0f8") +
theme(legend.position = "none",
plot.caption = element_text(hjust = .5, colour = "#219ebc"),
panel.background = element_rect(fill = "#03071e"),
plot.background = element_rect(fill = "#1b263b"),
plot.title = element_text(colour = "#219ebc"),
plot.subtitle = element_text(colour = "#219ebc", size = 10)) +
labs(title = "Network graph of One-star Casual Western Restaurant Trip Advisor Review Descriptions",
subtitle = "Line thickness indicates number of events involving those words, line transparency indicates the correlation between words. Key topics highlighted.",
caption = "Source: TripAdvisor; Ng Choon Khon")
ggsave(here("plots", "trip_casual_western_5_star_network_graph.png"),
width = 10, height = 6.5, units = "in", dpi = 300)
google_rating_bigrams |>
mutate(rating = as.factor(rating)) |>
arrange(desc(n)) |>
group_by(rating) |>
slice(1:15) |>
ungroup() |>
ggplot(aes(x = n, y = reorder_within(bigram, n, rating))) +
geom_col(aes(fill = rating)) +
scale_fill_manual(values = c(
1 = "#e76f51",
google_rating_bigrams |>
mutate(rating = as.factor(rating)) |>
arrange(desc(n)) |>
group_by(rating) |>
slice(1:15) |>
ungroup() |>
ggplot(aes(x = n, y = reorder_within(bigram, n, rating))) +
geom_col(aes(fill = rating)) +
scale_fill_manual(values = c(
1 = "#e76f51",
google_rating_bigrams |>
mutate(rating = as.factor(rating)) |>
arrange(desc(n)) |>
group_by(rating) |>
slice(1:15) |>
ungroup() |>
ggplot(aes(x = n, y = reorder_within(bigram, n, rating))) +
geom_col(aes(fill = rating)) +
scale_fill_manual(values = c(
`1` = "#e76f51",
`2` = "#f4a261",
`3` = "#e9c46a",
`4` = "#2a9d8f",
`5` = "#264653"
)) +
facet_wrap(~ rating, scales = "free") +
scale_y_reordered() +
guides(fill = "none") +
theme(strip.background = element_rect(fill = "black")) +
labs(x = "Count",
y = "",
title = "Most common bigrams by rating, Google reviews")
trip_rating_bigrams |>
filter(bigram %out% c("kuala lumpur")) |>
mutate(rating = as.factor(rating)) |>
arrange(desc(n)) |>
group_by(rating) |>
slice(1:20) |>
ungroup() |>
ggplot(aes(x = n, y = reorder_within(bigram, n, rating))) +
geom_col(aes(fill = rating)) +
scale_fill_manual(values = c(
`1` = "#e76f51",
`2` = "#f4a261",
`3` = "#e9c46a",
`4` = "#2a9d8f",
`5` = "#264653"
)) +
facet_wrap(~ rating, scales = "free") +
scale_y_reordered() +
guides(fill = "none") +
theme(strip.background = element_rect(fill = "black")) +
labs(x = "Count",
y = "",
title = "Most common bigrams by rating, Trip Advisor reviews")
trip_rating_bigrams |>
filter(bigram %out% c("kuala lumpur")) |>
mutate(rating = as.factor(rating)) |>
arrange(desc(n)) |>
group_by(rating) |>
slice(1:15) |>
ungroup() |>
ggplot(aes(x = n, y = reorder_within(bigram, n, rating))) +
geom_col(aes(fill = rating)) +
scale_fill_manual(values = c(
`1` = "#e76f51",
`2` = "#f4a261",
`3` = "#e9c46a",
`4` = "#2a9d8f",
`5` = "#264653"
)) +
facet_wrap(~ rating, scales = "free") +
scale_y_reordered() +
guides(fill = "none") +
theme(strip.background = element_rect(fill = "black")) +
labs(x = "Count",
y = "",
title = "Most common bigrams by rating, Trip Advisor reviews")
knitr::opts_chunk$set(echo = FALSE,
warning = FALSE,
message = FALSE,
fig.width = 9)
library(tidyverse)
library(here)
library(janitor)
library(scales)
library(tidytext)
library(widyr)
library(ggraph)
library(patchwork)
library(kableExtra)
library(fuzzyjoin)
library(viridis)
library(textdata)
library(stringr)
library(topicmodels)
`%out%` <- Negate(`%in%`)
options(scipen = 100)
theme_set(theme_light())
range_wna <- function(x){(x-min(x, na.rm = TRUE))/(max(x, na.rm = TRUE)-min(x, na.rm = TRUE))}
Mode <- function(x) {
ux <- unique(x)
ux[which.max(tabulate(match(x, ux)))]
}
trip_kl_cuisine <- read_csv("./data/trip_kl_cuisine.csv")
google_kl_cuisine <- read_csv("./data/google_kl_cuisine.csv")
google_rating_words <- google_kl_cuisine |>
select(rowid, rating, review) |>
unnest_tokens(word, review) |>
# mutate(word = SnowballC::wordStem(word, language = "porter")) |>
anti_join(stop_words, by = "word") |>
add_count(word, rating)
trip_rating_words <- trip_kl_cuisine |>
select(rowid, review, rating) |>
unnest_tokens(word, review) |>
# mutate(word = SnowballC::wordStem(word, language = "porter")) |>
anti_join(stop_words, by = "word") |>
add_count(word, rating)
# Commented out because I've written them into CSVs already
# So I don't keep on stressing the environment
# google_rating_bigrams <- google_kl_cuisine |>
#   select(rowid, rating, review, cuisine) |>
#   unnest_tokens(bigram, review, token = "ngrams", n = 2) |>
#   filter(!is.na(bigram)) |>
#   add_count(bigram) |>
#   separate(bigram, c("word1", "word2"), sep = " ") |>
#   filter(!word1 %in% stop_words$word) |>
#   filter(!word2 %in% stop_words$word) |>
#   count(word1, word2, rating, sort = TRUE) |>
#   unite(bigram, word1, word2, sep = " ") |>
#   bind_tf_idf(bigram, rating, n)
# trip_rating_bigrams <- trip_kl_cuisine |>
#   select(rowid, rating, review, cuisine) |>
#   unnest_tokens(bigram, review, token = "ngrams", n = 2) |>
#   filter(!is.na(bigram)) |>
#   add_count(bigram) |>
#   separate(bigram, c("word1", "word2"), sep = " ") |>
#   filter(!word1 %in% stop_words$word) |>
#   filter(!word2 %in% stop_words$word) |>
#   count(word1, word2, rating, sort = TRUE) |>
#   unite(bigram, word1, word2, sep = " ") |>
#   bind_tf_idf(bigram, rating, n)
google_rating_bigrams <- read_csv("./data/google_rating_bigrams.csv")
trip_rating_bigrams <- read_csv("./data/trip_rating_bigrams.csv")
clean_common_foods <- function(tbl){
tbl |>
mutate(review = str_replace_all(review, "Dim sum|Dim Sum|dim sum", "dimsum"),
review = str_replace_all(review, "Tom Yam|Tom Yum|Tom yam|Tom yum|tom yam|tom yum", "tomyum"),
review = str_replace_all(review, "Char Siew|Char siew|char siew", "charsiew"),
review = str_replace_all(review, "Hokkien mee|Hokkien Mee|hokkien mee", "hokkienmee"),
review = str_replace_all(review, "Roast Duck|Roast duck|roast duck", "roastduck"),
review = str_replace_all(review, "Fried Rice|Fried rice|fried rice", "friedrice"),
review = str_replace_all(review, "Roast pork|roast pork|Roast Pork", "roastpork"),
review = str_replace_all(review, "Mee hoon|mee hoon|Bee hoon|bee hoon|Mee Hoon|Bee Hoon", "beehoon"),
review = str_replace_all(review, "Bak kut teh|bak kut teh|Bak Kut Teh", "bakkutteh"),
review = str_replace_all(review, "char kuey teow|Char kuey teow|char koay teow|Char Kuey Teow", "charkueyteow"),
review = str_replace_all(review, "Hong Kong|hong kong", "hongkong"),
review = str_replace_all(review, "Siew yoke|siew yoke|siu yuk|Siu Yuk", "siewyoke"),
review = str_replace_all(review, "chee cheong fun|Chee cheong fun", "cheecheongfun"),
review = str_replace_all(review, "Kaya toast|kaya toast", "kaya toast"),
review = str_replace_all(review, "Din Tai Fung|din tai fung", "dintaifung"),
review = str_replace_all(review, "Salted egg|salted egg", "saltedegg"),
review = str_replace_all(review, "Kuala Lumpur|kuala lumpur|Kuala lumpur", "kl"),
review = str_replace_all(review, "Xiao long bao|xiao long bao|Xiao Long Bao", "xiaolongbao"),
review = str_replace_all(review, "Chicken rice|chicken rice|Chicken Rice", "chickenrice"),
review = str_replace_all(review, "Foreign workers|foreign workers", "foreignworkers"))
}
google_chinese_5_star_network <- google_kl_cuisine |>
clean_common_foods() |>
mutate(review_id = row_number()) |>
filter(cuisine == "Chinese" & rating == 5) |>
unnest_tokens(word, review) |>
anti_join(stop_words) |>
filter(str_detect(word, "[a-z]")) |>
add_count(word) |>
filter(n > 20) |>
pairwise_cor(word, review_id, sort = TRUE) |>
filter(correlation >= .15) |>
left_join(
google_kl_cuisine |>
clean_common_foods() |>
mutate(review_id = row_number()) |>
filter(cuisine == "Chinese" & rating == 5) |>
unnest_tokens(word, review) |>
anti_join(stop_words) |>
filter(str_detect(word, "[a-z]")) |>
add_count(word) |>
filter(n > 20) |>
pairwise_count(word, review_id, sort = TRUE),
by = c("item1", "item2")
) |>
igraph::graph_from_data_frame() |>
ggraph(layout = "fr") +
geom_edge_link(aes(alpha = correlation, edge_width = n), colour = "#457b9d", check_overlap = TRUE) +
scale_edge_width_continuous(range = c(.1, 4), trans = "log10") +
scale_alpha_continuous(range = c(0.01, 0.08)) +
geom_node_point(colour = "#457b9d", alpha = 0.2, size = .5) +
geom_node_text(aes(label = ifelse(name %in%
c("peak", "service", "experience",
"price", "pork", "fresh", "fish",
"tasted", "recommended", "friendly", "crispy"),
str_to_title(name),
"")),
size = 3,
alpha = .9,
colour = "#00afb9",
fontface = "bold") +
geom_node_text(aes(label = name), size = 3.1, alpha = .4,
colour = "#caf0f8") +
theme(legend.position = "none",
plot.caption = element_text(hjust = .5, colour = "#219ebc"),
panel.background = element_rect(fill = "#03071e"),
plot.background = element_rect(fill = "#1b263b"),
plot.title = element_text(colour = "#219ebc"),
plot.subtitle = element_text(colour = "#219ebc", size = 10)) +
labs(title = "Network graph of Five-star Chinese Restaurant Google Review Descriptions",
subtitle = "Line thickness indicates number of reviews involving those words, line transparency indicates the correlation between words. Key topics highlighted.",
caption = "Source: maps.google.com; Ng Choon Khon")
ggsave(here("plots", "google_chinese_5_star_network_graph.png"),
width = 10, height = 6.5, units = "in", dpi = 300)
google_chinese_5_star_network <- google_kl_cuisine |>
clean_common_foods() |>
mutate(review_id = row_number()) |>
filter(cuisine == "Chinese" & rating == 5) |>
unnest_tokens(word, review) |>
anti_join(stop_words) |>
filter(str_detect(word, "[a-z]")) |>
add_count(word) |>
filter(n > 20) |>
pairwise_cor(word, review_id, sort = TRUE) |>
filter(correlation >= .15) |>
left_join(
google_kl_cuisine |>
clean_common_foods() |>
mutate(review_id = row_number()) |>
filter(cuisine == "Chinese" & rating == 5) |>
unnest_tokens(word, review) |>
anti_join(stop_words) |>
filter(str_detect(word, "[a-z]")) |>
add_count(word) |>
filter(n > 20) |>
pairwise_count(word, review_id, sort = TRUE),
by = c("item1", "item2")
) |>
igraph::graph_from_data_frame() |>
ggraph(layout = "fr") +
geom_edge_link(aes(alpha = correlation, edge_width = n), colour = "#457b9d", check_overlap = TRUE) +
scale_edge_width_continuous(range = c(.1, 4), trans = "log10") +
scale_alpha_continuous(range = c(0.01, 0.08)) +
geom_node_point(colour = "#457b9d", alpha = 0.2, size = .5) +
geom_node_text(aes(label = ifelse(name %in%
c("peak", "service", "experience",
"price", "pork", "fresh", "fish",
"tasted", "recommended", "friendly", "crispy"),
str_to_title(name),
"")),
size = 3.2,
alpha = .9,
colour = "#00afb9",
fontface = "bold") +
geom_node_text(aes(label = name), size = 3.1, alpha = .4,
colour = "#caf0f8") +
theme(legend.position = "none",
plot.caption = element_text(hjust = .5, colour = "#219ebc"),
panel.background = element_rect(fill = "#03071e"),
plot.background = element_rect(fill = "#1b263b"),
plot.title = element_text(colour = "#219ebc"),
plot.subtitle = element_text(colour = "#219ebc", size = 10)) +
labs(title = "Network graph of Five-star Chinese Restaurant Google Review Descriptions",
subtitle = "Line thickness indicates number of reviews involving those words, line transparency indicates the correlation between words. Key topics highlighted.",
caption = "Source: maps.google.com; Ng Choon Khon")
ggsave(here("plots", "google_chinese_5_star_network_graph.png"),
width = 10, height = 6.5, units = "in", dpi = 300)
google_bigrams_topics |>
# Remember topic 1 is recommended
mutate(topic = ifelse(
topic == 1, "1. Recommended", "2. Everything else"
)) |>
group_by(topic) |>
slice_max(beta, n = 20) |>
ungroup() |>
arrange(topic, -beta) |>
ggplot(aes(x = beta, y = reorder_within(term, beta, topic), fill = topic)) +
geom_col() +
scale_fill_manual(
values = c("1. Recommended" = "#8ac926",
"2. Everything else" = "#ff595e")
) +
facet_wrap(~ topic, scales = "free_y") +
scale_y_reordered() +
labs(title = "20 most-probable bigram per topic",
subtitle = "From Google reviews of restaurants in the Klang Valley.\nOnly shows bigrams that occur more than 20 times in the dataset.",
y = "",
x = "Per-topic probability (beta)") +
guides(fill = "none") +
theme(strip.background = element_rect(fill = "black"),
strip.text = element_text(size = 10, face = "bold"))
google_bigrams_dtm <- google_rating_bigrams |>
cast_dtm(rating, bigram, n)
google_bigrams_lda <-
LDA(google_bigrams_dtm, k = 2, control = list(seed = 133))
google_bigrams_topics <- tidy(google_bigrams_lda, matrix = "beta")
google_bigrams_topics |>
# Remember topic 1 is recommended
mutate(topic = ifelse(
topic == 1, "1. Recommended", "2. Everything else"
)) |>
group_by(topic) |>
slice_max(beta, n = 20) |>
ungroup() |>
arrange(topic, -beta) |>
ggplot(aes(x = beta, y = reorder_within(term, beta, topic), fill = topic)) +
geom_col() +
scale_fill_manual(
values = c("1. Recommended" = "#8ac926",
"2. Everything else" = "#ff595e")
) +
facet_wrap(~ topic, scales = "free_y") +
scale_y_reordered() +
labs(title = "20 most-probable bigram per topic",
subtitle = "From Google reviews of restaurants in the Klang Valley.\nOnly shows bigrams that occur more than 20 times in the dataset.",
y = "",
x = "Per-topic probability (beta)") +
guides(fill = "none") +
theme(strip.background = element_rect(fill = "black"),
strip.text = element_text(size = 10, face = "bold"))
google_bigrams_topics |>
# Remember topic 1 is recommended
mutate(topic = ifelse(
topic == 1, "2. Everything else", "1. Recommended"
)) |>
group_by(topic) |>
slice_max(beta, n = 20) |>
ungroup() |>
arrange(topic, -beta) |>
ggplot(aes(x = beta, y = reorder_within(term, beta, topic), fill = topic)) +
geom_col() +
scale_fill_manual(
values = c("1. Recommended" = "#8ac926",
"2. Everything else" = "#ff595e")
) +
facet_wrap(~ topic, scales = "free_y") +
scale_y_reordered() +
labs(title = "20 most-probable bigram per topic",
subtitle = "From Google reviews of restaurants in the Klang Valley.\nOnly shows bigrams that occur more than 20 times in the dataset.",
y = "",
x = "Per-topic probability (beta)") +
guides(fill = "none") +
theme(strip.background = element_rect(fill = "black"),
strip.text = element_text(size = 10, face = "bold"))
google_bigrams_topics |>
# Remember topic 1 is recommended
mutate(topic = ifelse(
topic == 1, "2. Everything else", "1. Recommended"
)) |>
filter(term %in% c(
# Because they stayed long enough for dessert?
"ice cream",
"indian food",
"chinese restaurant",
"roast pork",
"salted egg",
"dim sum",
"nasi lemak",
"fried chicken",
"fried rice",
"japanese food",
"thai food",
"chicken rice",
"italian restaurant",
"western food",
"nasi kandar",
"char siew"
)) |>
ggplot(aes(x = beta,
y = fct_rev(topic))) +
geom_col(aes(fill = topic)) +
scale_fill_manual(
values = c("1. Recommended" = "#8ac926",
"2. Everything else" = "#ff595e")
) +
facet_wrap(~ term) +
guides(fill = "none") +
theme(strip.background = element_rect(fill = "black"),
axis.text.x = element_text(size = 7)) +
labs(title = "Per-topic probabilities of foods and cuisines",
subtitle = "Google reviews in the Klang Valley",
y = "")
google_bigrams_topics |>
# Remember topic 1 is recommended
mutate(topic = ifelse(
topic == 1, "2. Everything else", "1. Recommended"
)) |>
filter(term %in% c(
"reasonable price",
"highly recommend",
"highly recommended",
"amazing food",
"nice environment",
"food quality",
"nice food",
"bit pricey",
"excellent service",
"decent food",
"friendly staff",
"excellent food"
)) |>
ggplot(aes(x = beta,
y = fct_rev(topic))) +
geom_col(aes(fill = topic)) +
scale_fill_manual(
values = c("1. Recommended" = "#8ac926",
"2. Everything else" = "#ff595e")
) +
facet_wrap(~ term) +
guides(fill = "none") +
theme(strip.background = element_rect(fill = "black")) +
labs(y = "",
title = "Per-topic probabilities of general restaurant descriptors")
trip_rating_bigrams |>
filter(bigram %out% c("kuala lumpur")) |>
mutate(rating = as.factor(rating)) |>
arrange(desc(n)) |>
group_by(rating) |>
slice(1:15) |>
ungroup() |>
ggplot(aes(x = n, y = reorder_within(bigram, n, rating))) +
geom_col(aes(fill = rating)) +
scale_fill_manual(values = c(
`1` = "#e76f51",
`2` = "#f4a261",
`3` = "#e9c46a",
`4` = "#2a9d8f",
`5` = "#264653"
)) +
facet_wrap(~ rating, scales = "free") +
scale_y_reordered() +
guides(fill = "none") +
theme(strip.background = element_rect(fill = "black")) +
labs(x = "Count",
y = "",
title = "Most common bigrams by rating, Trip Advisor reviews")
google_rating_bigrams |>
mutate(rating = as.factor(rating)) |>
arrange(desc(n)) |>
group_by(rating) |>
slice(1:15) |>
ungroup() |>
ggplot(aes(x = n, y = reorder_within(bigram, n, rating))) +
geom_col(aes(fill = rating)) +
scale_fill_manual(values = c(
`1` = "#e76f51",
`2` = "#f4a261",
`3` = "#e9c46a",
`4` = "#2a9d8f",
`5` = "#264653"
)) +
facet_wrap(~ rating, scales = "free") +
scale_y_reordered() +
guides(fill = "none") +
theme(strip.background = element_rect(fill = "black")) +
labs(x = "Count",
y = "",
title = "Most common bigrams by rating, Google reviews")
ggsave("./plots/common_bigrams_google.png", height = 5, width = 7, units = "in")
